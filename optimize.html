<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MIT Parallel Computing and Scientific Machine Learning - 1&nbsp; Optimizing Serial Code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./sciml.html" rel="next">
<link href="./intro.html" rel="prev">
<link href="./sciml-book-logo.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro.html">Introduction to Parallel Computing</a></li><li class="breadcrumb-item"><a href="./optimize.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Optimizing Serial Code</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./sciml-book-logo.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MIT Parallel Computing and Scientific Machine Learning</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/jvaverka/SciMLBook" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./MIT-Parallel-Computing-and-Scientific-Machine-Learning.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./MIT-Parallel-Computing-and-Scientific-Machine-Learning.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Parallel Computing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimize.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Optimizing Serial Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sciml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Scientific Machine Learning through Physics-Informed Neural Networks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Parallel Computing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dynamical_systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">How Loops Work, An Introduction to Discrete Dynamics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parallelism_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">The Basics of Single Node Parallel Computing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./styles_of_parallelism.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Different Flavors of Parallelism</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discretizing_odes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ordinary Differential Equations, Applications and Discretizations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Modern Approaches</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./automatic_differentiation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Forward-Mode Automatic Differentiation (AD) via High Dimensional Algebras</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stiff_odes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Solving Stiff Ordinary Differential Equations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation_identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Basic Parameter Estimation, Reverse-Mode AD, and Inverse Problems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./adjoints.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Differentiable Programming and Neural Differential Equations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Modern Architectures</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mpi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introduction to MPI.jl</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gpus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">GPU programming</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Advanced Differential Equations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pdes_and_convolutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">PDEs, Convolutions, and the Mathematics of Locality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diffeq_machine_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Mixing Differential Equations and Neural Networks for Physics-Informed Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probabilistic_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">From Optimization to Probabilistic Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./global_sensitivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Global Sensitivity Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./profiling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Code Profiling and Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Uncertainty Programming, Generalized Uncertainty Quantification</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#mental-model-of-a-memory" id="toc-mental-model-of-a-memory" class="nav-link active" data-scroll-target="#mental-model-of-a-memory"><span class="header-section-number">1.1</span> Mental Model of a Memory</a>
  <ul class="collapse">
  <li><a href="#high-level-view" id="toc-high-level-view" class="nav-link" data-scroll-target="#high-level-view"><span class="header-section-number">1.1.1</span> High Level View</a></li>
  <li><a href="#cache-lines-and-rowcolumn-major" id="toc-cache-lines-and-rowcolumn-major" class="nav-link" data-scroll-target="#cache-lines-and-rowcolumn-major"><span class="header-section-number">1.1.2</span> Cache Lines and Row/Column-Major</a></li>
  <li><a href="#lower-level-view-the-stack-and-the-heap" id="toc-lower-level-view-the-stack-and-the-heap" class="nav-link" data-scroll-target="#lower-level-view-the-stack-and-the-heap"><span class="header-section-number">1.1.3</span> Lower Level View: The Stack and the Heap</a></li>
  <li><a href="#heap-allocations-and-speed" id="toc-heap-allocations-and-speed" class="nav-link" data-scroll-target="#heap-allocations-and-speed"><span class="header-section-number">1.1.4</span> Heap Allocations and Speed</a></li>
  <li><a href="#mutation-to-avoid-heap-allocations" id="toc-mutation-to-avoid-heap-allocations" class="nav-link" data-scroll-target="#mutation-to-avoid-heap-allocations"><span class="header-section-number">1.1.5</span> Mutation to Avoid Heap Allocations</a></li>
  <li><a href="#julias-broadcasting-mechanism" id="toc-julias-broadcasting-mechanism" class="nav-link" data-scroll-target="#julias-broadcasting-mechanism"><span class="header-section-number">1.1.6</span> Julia’s Broadcasting Mechanism</a></li>
  <li><a href="#note-on-broadcasting-function-calls" id="toc-note-on-broadcasting-function-calls" class="nav-link" data-scroll-target="#note-on-broadcasting-function-calls"><span class="header-section-number">1.1.7</span> Note on Broadcasting Function Calls</a></li>
  <li><a href="#note-on-vectorization-and-speed" id="toc-note-on-vectorization-and-speed" class="nav-link" data-scroll-target="#note-on-vectorization-and-speed"><span class="header-section-number">1.1.8</span> Note on Vectorization and Speed</a></li>
  <li><a href="#heap-allocations-from-slicing" id="toc-heap-allocations-from-slicing" class="nav-link" data-scroll-target="#heap-allocations-from-slicing"><span class="header-section-number">1.1.9</span> Heap Allocations from Slicing</a></li>
  <li><a href="#asymptotic-cost-of-heap-allocations" id="toc-asymptotic-cost-of-heap-allocations" class="nav-link" data-scroll-target="#asymptotic-cost-of-heap-allocations"><span class="header-section-number">1.1.10</span> Asymptotic Cost of Heap Allocations</a></li>
  <li><a href="#optimizing-memory-use-summary" id="toc-optimizing-memory-use-summary" class="nav-link" data-scroll-target="#optimizing-memory-use-summary"><span class="header-section-number">1.1.11</span> Optimizing Memory Use Summary</a></li>
  </ul></li>
  <li><a href="#julias-type-inference-and-the-compiler" id="toc-julias-type-inference-and-the-compiler" class="nav-link" data-scroll-target="#julias-type-inference-and-the-compiler"><span class="header-section-number">1.2</span> Julia’s Type Inference and the Compiler</a>
  <ul class="collapse">
  <li><a href="#type-inference" id="toc-type-inference" class="nav-link" data-scroll-target="#type-inference"><span class="header-section-number">1.2.1</span> Type Inference</a></li>
  <li><a href="#type-specialization-in-functions" id="toc-type-specialization-in-functions" class="nav-link" data-scroll-target="#type-specialization-in-functions"><span class="header-section-number">1.2.2</span> Type Specialization in Functions</a></li>
  <li><a href="#type-stability" id="toc-type-stability" class="nav-link" data-scroll-target="#type-stability"><span class="header-section-number">1.2.3</span> Type Stability</a></li>
  <li><a href="#multiple-dispatch" id="toc-multiple-dispatch" class="nav-link" data-scroll-target="#multiple-dispatch"><span class="header-section-number">1.2.4</span> Multiple Dispatch</a></li>
  <li><a href="#any-fallbacks" id="toc-any-fallbacks" class="nav-link" data-scroll-target="#any-fallbacks"><span class="header-section-number">1.2.5</span> Any Fallbacks</a></li>
  <li><a href="#ambiguities" id="toc-ambiguities" class="nav-link" data-scroll-target="#ambiguities"><span class="header-section-number">1.2.6</span> Ambiguities</a></li>
  <li><a href="#untyped-containers" id="toc-untyped-containers" class="nav-link" data-scroll-target="#untyped-containers"><span class="header-section-number">1.2.7</span> Untyped Containers</a></li>
  <li><a href="#type-definitions" id="toc-type-definitions" class="nav-link" data-scroll-target="#type-definitions"><span class="header-section-number">1.2.8</span> Type definitions</a></li>
  <li><a href="#value-types-and-isbits" id="toc-value-types-and-isbits" class="nav-link" data-scroll-target="#value-types-and-isbits"><span class="header-section-number">1.2.9</span> Value types and isbits</a></li>
  <li><a href="#note-on-julia" id="toc-note-on-julia" class="nav-link" data-scroll-target="#note-on-julia"><span class="header-section-number">1.2.10</span> Note on Julia</a></li>
  <li><a href="#note-on-isbits" id="toc-note-on-isbits" class="nav-link" data-scroll-target="#note-on-isbits"><span class="header-section-number">1.2.11</span> Note on isbits</a></li>
  <li><a href="#function-barriers" id="toc-function-barriers" class="nav-link" data-scroll-target="#function-barriers"><span class="header-section-number">1.2.12</span> Function Barriers</a></li>
  <li><a href="#specialization-at-compile-time" id="toc-specialization-at-compile-time" class="nav-link" data-scroll-target="#specialization-at-compile-time"><span class="header-section-number">1.2.13</span> Specialization at Compile Time</a></li>
  <li><a href="#global-scope-and-optimizations" id="toc-global-scope-and-optimizations" class="nav-link" data-scroll-target="#global-scope-and-optimizations"><span class="header-section-number">1.2.14</span> Global Scope and Optimizations</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">1.2.15</span> Summary</a></li>
  </ul></li>
  <li><a href="#overheads-of-individual-operations" id="toc-overheads-of-individual-operations" class="nav-link" data-scroll-target="#overheads-of-individual-operations"><span class="header-section-number">1.3</span> Overheads of Individual Operations</a>
  <ul class="collapse">
  <li><a href="#bounds-checking" id="toc-bounds-checking" class="nav-link" data-scroll-target="#bounds-checking"><span class="header-section-number">1.3.1</span> Bounds Checking</a></li>
  <li><a href="#simd" id="toc-simd" class="nav-link" data-scroll-target="#simd"><span class="header-section-number">1.3.2</span> SIMD</a></li>
  <li><a href="#fma" id="toc-fma" class="nav-link" data-scroll-target="#fma"><span class="header-section-number">1.3.3</span> FMA</a></li>
  <li><a href="#inlining" id="toc-inlining" class="nav-link" data-scroll-target="#inlining"><span class="header-section-number">1.3.4</span> Inlining</a></li>
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1"><span class="header-section-number">1.3.5</span> Summary</a></li>
  </ul></li>
  <li><a href="#note-on-benchmarking" id="toc-note-on-benchmarking" class="nav-link" data-scroll-target="#note-on-benchmarking"><span class="header-section-number">1.4</span> Note on Benchmarking</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">1.5</span> Conclusion</a></li>
  <li><a href="#discussion-questions" id="toc-discussion-questions" class="nav-link" data-scroll-target="#discussion-questions"><span class="header-section-number">2</span> Discussion Questions</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jvaverka/SciMLBook/edit/main/optimize.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/jvaverka/SciMLBook/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/jvaverka/SciMLBook/blob/main/optimize.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Optimizing Serial Code</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>At the center of any fast parallel code is a fast serial code. Parallelism is made to be a performance multiplier, so if you start from a bad position it won’t ever get much better. Thus the first thing that we need to do is understand what makes code slow and how to avoid the pitfalls. This discussion of serial code optimization will also directly motivate why we will be using Julia throughout this course.</p>
<section id="mental-model-of-a-memory" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="mental-model-of-a-memory"><span class="header-section-number">1.1</span> Mental Model of a Memory</h2>
<p>To start optimizing code you need a good mental model of a computer.</p>
<section id="high-level-view" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="high-level-view"><span class="header-section-number">1.1.1</span> High Level View</h3>
<p>At the highest level you have a CPU’s core memory which directly accesses a L1 cache. The L1 cache has the fastest access, so things which will be needed soon are kept there. However, it is filled from the L2 cache, which itself is filled from the L3 cache, which is filled from the main memory. This bring us to the first idea in optimizing code: using things that are already in a closer cache can help the code run faster because it doesn’t have to be queried for and moved up this chain.</p>
<p><img src="https://hackernoon.com/hn-images/1*nT3RAGnOAWmKmvOBnizNtw.png" class="img-fluid"></p>
<p>When something needs to be pulled directly from main memory this is known as a <em>cache miss</em>. To understand the cost of a cache miss vs standard calculations, take a look at <a href="http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/">this classic chart</a>.</p>
<p>(Cache-aware and cache-oblivious algorithms are methods which change their indexing structure to optimize their use of the cache lines. We will return to this when talking about performance of linear algebra.)</p>
</section>
<section id="cache-lines-and-rowcolumn-major" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="cache-lines-and-rowcolumn-major"><span class="header-section-number">1.1.2</span> Cache Lines and Row/Column-Major</h3>
<p>Many algorithms in numerical linear algebra are designed to minimize cache misses. Because of this chain, many modern CPUs try to guess what you will want next in your cache. When dealing with arrays, it will speculate ahead and grab what is known as a <em>cache line</em>: the next chunk in the array. Thus, your algorithms will be faster if you iterate along the values that it is grabbing.</p>
<p>The values that it grabs are the next values in the contiguous order of the stored array. There are two common conventions: row major and column major. Row major means that the linear array of memory is formed by stacking the rows one after another, while column major puts the column vectors one after another.</p>
<p><img src="https://eli.thegreenplace.net/images/2015/column-major-2D.png" class="img-fluid"></p>
<p><em>Julia, MATLAB, and Fortran are column major</em>. Python’s numpy is row-major.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">100</span>, <span class="fl">100</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">100</span>, <span class="fl">100</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> <span class="fu">rand</span>(<span class="fl">100</span>, <span class="fl">100</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_rows!</span>(C, A, B)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_rows!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  8.878 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_cols!</span>(C, A, B)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_cols!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  5.703 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
</section>
<section id="lower-level-view-the-stack-and-the-heap" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="lower-level-view-the-stack-and-the-heap"><span class="header-section-number">1.1.3</span> Lower Level View: The Stack and the Heap</h3>
<p>Locally, the stack is composed of a <em>stack</em> and a <em>heap</em>. The stack requires a static allocation: it is ordered. Because it’s ordered, it is very clear where things are in the stack, and therefore accesses are very quick (think instantaneous). However, because this is static, it requires that the size of the variables is known at compile time (to determine all of the variable locations). Since that is not possible with all variables, there exists the heap. The heap is essentially a stack of pointers to objects in memory. When heap variables are needed, their values are pulled up the cache chain and accessed.</p>
<p><img src="https://bayanbox.ir/view/581244719208138556/virtual-memory.jpg" class="img-fluid"> <img src="https://camo.githubusercontent.com/ca96d70d09ce694363e44b93fd975bb3033898c1/687474703a2f2f7475746f7269616c732e6a656e6b6f762e636f6d2f696d616765732f6a6176612d636f6e63757272656e63792f6a6176612d6d656d6f72792d6d6f64656c2d352e706e67.png" class="img-fluid"></p>
</section>
<section id="heap-allocations-and-speed" class="level3" data-number="1.1.4">
<h3 data-number="1.1.4" class="anchored" data-anchor-id="heap-allocations-and-speed"><span class="header-section-number">1.1.4</span> Heap Allocations and Speed</h3>
<p>Heap allocations are costly because they involve this pointer indirection, so stack allocation should be done when sensible (it’s not helpful for really large arrays, but for small values like scalars it’s essential!)</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_alloc!</span>(C, A, B)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> [A[i, j] <span class="op">+</span> B[i, j]]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> val[<span class="fl">1</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_alloc!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  220.423 μs (10000 allocations: 625.00 KiB)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_noalloc!</span>(C, A, B)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> val[<span class="fl">1</span>]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_noalloc!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  8.064 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
<p>Why does the array here get heap-allocated? It isn’t able to prove/guarantee at compile-time that the array’s size will always be a given value, and thus it allocates it to the heap. <code>@btime</code> tells us this allocation occurred and shows us the total heap memory that was taken. Meanwhile, the size of a Float64 number is known at compile-time (64-bits), and so this is stored onto the stack and given a specific location that the compiler will be able to directly address.</p>
<p>Note that one can use the StaticArrays.jl library to get statically-sized arrays and thus arrays which are stack-allocated:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StaticArrays</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">static_inner_alloc!</span>(C, A, B)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> <span class="pp">@SVector</span> [A[i, j] <span class="op">+</span> B[i, j]]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> val[<span class="fl">1</span>]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">static_inner_alloc!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  5.710 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
</section>
<section id="mutation-to-avoid-heap-allocations" class="level3" data-number="1.1.5">
<h3 data-number="1.1.5" class="anchored" data-anchor-id="mutation-to-avoid-heap-allocations"><span class="header-section-number">1.1.5</span> Mutation to Avoid Heap Allocations</h3>
<p>Many times you do need to write into an array, so how can you write into an array without performing a heap allocation? The answer is mutation. Mutation is changing the values of an already existing array. In that case, no free memory has to be found to put the array (and no memory has to be freed by the garbage collector).</p>
<p>In Julia, functions which mutate the first value are conventionally noted by a <code>!</code>. See the difference between these two equivalent functions:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_noalloc!</span>(C, A, B)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> val[<span class="fl">1</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_noalloc!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  7.863 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_alloc</span>(A, B)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  C <span class="op">=</span> <span class="fu">similar</span>(A)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> val[<span class="fl">1</span>]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_alloc</span>(A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  8.782 μs (2 allocations: 78.17 KiB)</code></pre>
</div>
</div>
<p>To use this algorithm effectively, the <code>!</code> algorithm assumes that the caller already has allocated the output array to put as the output argument. If that is not true, then one would need to manually allocate. The goal of that interface is to give the caller control over the allocations to allow them to manually reduce the total number of heap allocations and thus increase the speed.</p>
</section>
<section id="julias-broadcasting-mechanism" class="level3" data-number="1.1.6">
<h3 data-number="1.1.6" class="anchored" data-anchor-id="julias-broadcasting-mechanism"><span class="header-section-number">1.1.6</span> Julia’s Broadcasting Mechanism</h3>
<p>Wouldn’t it be nice to not have to write the loop there? In many high level languages this is simply called <em>vectorization</em>. In Julia, we will call it <em>array vectorization</em> to distinguish it from the <em>SIMD vectorization</em> which is common in lower level languages like C, Fortran, and Julia.</p>
<p>In Julia, if you use <code>.</code> on an operator it will transform it to the broadcasted form. Broadcast is <em>lazy</em>: it will build up an entire <code>.</code>’d expression and then call <code>broadcast!</code> on composed expression. This is customizable and <a href="https://docs.julialang.org/en/v1/manual/interfaces/#man-interfaces-broadcasting-1">documented in detail</a>. However, to a first approximation we can think of the broadcast mechanism as a mechanism for building <em>fused expressions</em>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Julia</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Under the Hood</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">R</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>High-level code a Julia user would write.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">.+</span> B <span class="op">.+</span> C</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>The high-level code lowers to something like:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>((a, b, c) <span class="op">-&gt;</span> a <span class="op">+</span> b <span class="op">+</span> c, A, B, C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>map</code> is a mechanism to apply some function to each element of a collection. This general pattern is how to apply <code>some_func</code> elemement-wise to all values of <code>some_collection</code>.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>((x) <span class="op">-&gt;</span> some_func, some_collection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Some form of this pattern is supported in most programming languages. For example, in R the <code>apply</code>, <code>lapply</code>, or <code>sapply</code> may be used depending on the desired return type.</p>
<pre><code>sapply( some_collection, some_func )</code></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take a quick second to think about why loop fusion may be an optimization.</p>
</div>
</div>
<p>This about what would happen if you did not fuse the operations. We can write that out as:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> A <span class="op">.+</span> B</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">.+</span> C;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice that if we did not fuse the expressions, we would need some place to put the result of <code>A .+ B</code>, and that would have to be an array, which means it would cause a heap allocation. Thus broadcast fusion eliminates the <em>temporary variable</em> (colloquially called just a <em>temporary</em>).</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unfused</span>(A,  B, C)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  tmp <span class="op">=</span> A <span class="op">.+</span> B</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  tmp <span class="op">.+</span> C</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">unfused</span>(A, B, C);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  11.294 μs (4 allocations: 156.34 KiB)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fused</span>(A, B, C) <span class="op">=</span> A <span class="op">.+</span> B <span class="op">.+</span> C</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">fused</span>(A, B, C);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  4.873 μs (2 allocations: 78.17 KiB)</code></pre>
</div>
</div>
<p>Note that we can also fuse the output by using <code>.=</code>. This is essentially the vectorized version of a <code>!</code> function:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="fu">similar</span>(A)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fused!</span>(D, A, B, C) <span class="op">=</span> (D <span class="op">.=</span> A <span class="op">.+</span> B <span class="op">.+</span> C)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">fused!</span>(D, A, B, C);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  3.843 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
</section>
<section id="note-on-broadcasting-function-calls" class="level3" data-number="1.1.7">
<h3 data-number="1.1.7" class="anchored" data-anchor-id="note-on-broadcasting-function-calls"><span class="header-section-number">1.1.7</span> Note on Broadcasting Function Calls</h3>
<p>Julia allows for broadcasting the call <code>()</code> operator as well. <code>.()</code> will call the function element-wise on all arguments, so <code>sin.(A)</code> will be the elementwise sine function. This will fuse Julia like the other operators.</p>
</section>
<section id="note-on-vectorization-and-speed" class="level3" data-number="1.1.8">
<h3 data-number="1.1.8" class="anchored" data-anchor-id="note-on-vectorization-and-speed"><span class="header-section-number">1.1.8</span> Note on Vectorization and Speed</h3>
<p>In articles on MATLAB, Python, R, etc., this is where you will be told to vectorize your code. Notice from above that this isn’t a performance difference between writing loops and using vectorized broadcasts. This is not abnormal! The reason why you are told to vectorize code in these other languages is because they have a high per-operation overhead (which will be discussed further down). This means that every call, like <code>+</code>, is costly in these languages. To get around this issue and make the language usable, someone wrote and compiled the loop for the C/Fortran function that does the broadcasted form (see numpy’s Github repo). Thus <code>A .+ B</code>’s MATLAB/Python/R equivalents are calling a single C function to generally avoid the cost of function calls and thus are faster.</p>
<p>But this is not an intrinsic property of vectorization. Vectorization isn’t “fast” in these languages, it’s just close to the correct speed. The reason vectorization is recommended is because looping is slow in these languages. Because looping isn’t slow in Julia (or C, C++, Fortran, etc.), loops and vectorization generally have the same speed. So use the one that works best for your code without a care about performance.</p>
<p>(As a small side effect, these high level languages tend to allocate a lot of temporary variables since the individual C kernels are written for specific numbers of inputs and thus don’t naturally fuse. Julia’s broadcast mechanism is just generating and JIT compiling Julia functions on the fly, and thus it can accommodate the combinatorial explosion in the amount of choices just by only compiling the combinations that are necessary for a specific code)</p>
</section>
<section id="heap-allocations-from-slicing" class="level3" data-number="1.1.9">
<h3 data-number="1.1.9" class="anchored" data-anchor-id="heap-allocations-from-slicing"><span class="header-section-number">1.1.9</span> Heap Allocations from Slicing</h3>
<p>It’s important to note that slices in Julia produce copies instead of views. Thus for example:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>A[<span class="fl">50</span>, <span class="fl">50</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0.8678702655632916</code></pre>
</div>
</div>
<p>allocates a new output. This is for safety, since if it pointed to the same array then writing to it would change the original array. We can demonstrate this by asking for a <em>view</em> instead of a copy.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> A[<span class="fl">1</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>E <span class="op">=</span> <span class="pp">@view</span> A[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>E[<span class="fl">1</span>] <span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> A[<span class="fl">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A[1] = 0.23509670883450928
A[1] = 2.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>2.0</code></pre>
</div>
</div>
<p>However, this means that <code>@view A[1:5, 1:5]</code> did not allocate an array (it does allocate a pointer if the escape analysis is unable to prove that it can be elided. This means that in small loops there will be no allocation, while if the view is returned from a function for example it will allocate the pointer, ~80 bytes, but not the memory of the array. This means that it is O(1) in cost but with a relatively small constant).</p>
</section>
<section id="asymptotic-cost-of-heap-allocations" class="level3" data-number="1.1.10">
<h3 data-number="1.1.10" class="anchored" data-anchor-id="asymptotic-cost-of-heap-allocations"><span class="header-section-number">1.1.10</span> Asymptotic Cost of Heap Allocations</h3>
<p>Heap allocations have to locate and prepare a space in RAM that is proportional to the amount of memory that is calculated, which means that the cost of a heap allocation for an array is O(n), with a large constant. As RAM begins to fill up, this cost dramatically increases. If you run out of RAM, your computer may begin to use <em>swap</em>, which is essentially RAM simulated on your hard drive. Generally when you hit swap your performance is so dead that you may think that your computation froze, but if you check your resource use you will notice that it’s actually just filled the RAM and starting to use the swap.</p>
<p>But think of it as O(n) with a large constant factor. This means that for operations which only touch the data once, heap allocations can dominate the computational cost:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span>, <span class="bu">BenchmarkTools</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">alloc_timer</span>(n)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> <span class="fu">rand</span>(n, n)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> <span class="fu">rand</span>(n, n)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> <span class="fu">rand</span>(n, n)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    t1 <span class="op">=</span> <span class="pp">@belapsed</span> <span class="op">$</span>A <span class="op">.*</span> <span class="op">$</span>B</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    t2 <span class="op">=</span> <span class="pp">@belapsed</span> (<span class="op">$</span>C <span class="op">.=</span> <span class="op">$</span>A <span class="op">.*</span> <span class="op">$</span>B)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    t1, t2</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>ns <span class="op">=</span> <span class="fl">2</span> <span class="op">.^</span> (<span class="fl">2</span><span class="op">:</span><span class="fl">11</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> [<span class="fu">alloc_timer</span>(n) for n <span class="kw">in</span> ns]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>alloc   <span class="op">=</span> [x[<span class="fl">1</span>] for x <span class="kw">in</span> res]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>noalloc <span class="op">=</span> [x[<span class="fl">2</span>] for x <span class="kw">in</span> res]</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ns, alloc;</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>     label <span class="op">=</span> <span class="st">"="</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>     xscale <span class="op">=</span> <span class="op">:</span>log10,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>     yscale <span class="op">=</span> <span class="op">:</span>log10,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>     legend <span class="op">=</span> <span class="op">:</span>bottomright,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>     title <span class="op">=</span> <span class="st">"Micro-optimizations matter for BLAS1"</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(ns, noalloc; label <span class="op">=</span> <span class="st">".="</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewbox="0 0 2400 1600">
<defs>
  <clippath id="clip650">
    <rect x="0" y="0" width="2400" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip650)" d="M0 1600 L2400 1600 L2400 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip651">
    <rect x="480" y="0" width="1681" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip650)" d="M189.233 1474.16 L2352.76 1474.16 L2352.76 123.472 L189.233 123.472  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip652">
    <rect x="189" y="123" width="2165" height="1352"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="550.257,1474.16 550.257,123.472 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1303.62,1474.16 1303.62,123.472 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2056.98,1474.16 2056.98,123.472 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,1474.16 2352.76,1474.16 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="550.257,1474.16 550.257,1455.27 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1303.62,1474.16 1303.62,1455.27 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2056.98,1474.16 2056.98,1455.27 "></polyline>
<path clip-path="url(#clip650)" d="M516.585 1548.29 L524.224 1548.29 L524.224 1521.92 L515.913 1523.59 L515.913 1519.33 L524.177 1517.66 L528.853 1517.66 L528.853 1548.29 L536.492 1548.29 L536.492 1552.22 L516.585 1552.22 L516.585 1548.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M555.936 1520.74 Q552.325 1520.74 550.497 1524.31 Q548.691 1527.85 548.691 1534.98 Q548.691 1542.09 550.497 1545.65 Q552.325 1549.19 555.936 1549.19 Q559.571 1549.19 561.376 1545.65 Q563.205 1542.09 563.205 1534.98 Q563.205 1527.85 561.376 1524.31 Q559.571 1520.74 555.936 1520.74 M555.936 1517.04 Q561.746 1517.04 564.802 1521.65 Q567.881 1526.23 567.881 1534.98 Q567.881 1543.71 564.802 1548.31 Q561.746 1552.9 555.936 1552.9 Q550.126 1552.9 547.047 1548.31 Q543.992 1543.71 543.992 1534.98 Q543.992 1526.23 547.047 1521.65 Q550.126 1517.04 555.936 1517.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M568.426 1521.62 L574.633 1521.62 L574.633 1500.19 L567.881 1501.55 L567.881 1498.09 L574.595 1496.73 L578.394 1496.73 L578.394 1521.62 L584.601 1521.62 L584.601 1524.81 L568.426 1524.81 L568.426 1521.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1269.39 1548.29 L1277.03 1548.29 L1277.03 1521.92 L1268.72 1523.59 L1268.72 1519.33 L1276.98 1517.66 L1281.66 1517.66 L1281.66 1548.29 L1289.3 1548.29 L1289.3 1552.22 L1269.39 1552.22 L1269.39 1548.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1308.74 1520.74 Q1305.13 1520.74 1303.3 1524.31 Q1301.5 1527.85 1301.5 1534.98 Q1301.5 1542.09 1303.3 1545.65 Q1305.13 1549.19 1308.74 1549.19 Q1312.38 1549.19 1314.18 1545.65 Q1316.01 1542.09 1316.01 1534.98 Q1316.01 1527.85 1314.18 1524.31 Q1312.38 1520.74 1308.74 1520.74 M1308.74 1517.04 Q1314.55 1517.04 1317.61 1521.65 Q1320.69 1526.23 1320.69 1534.98 Q1320.69 1543.71 1317.61 1548.31 Q1314.55 1552.9 1308.74 1552.9 Q1302.93 1552.9 1299.85 1548.31 Q1296.8 1543.71 1296.8 1534.98 Q1296.8 1526.23 1299.85 1521.65 Q1302.93 1517.04 1308.74 1517.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1325.26 1521.62 L1338.52 1521.62 L1338.52 1524.81 L1320.69 1524.81 L1320.69 1521.62 Q1322.85 1519.38 1326.57 1515.62 Q1330.32 1511.84 1331.28 1510.75 Q1333.1 1508.7 1333.82 1507.29 Q1334.55 1505.86 1334.55 1504.48 Q1334.55 1502.24 1332.97 1500.83 Q1331.41 1499.42 1328.89 1499.42 Q1327.1 1499.42 1325.11 1500.04 Q1323.13 1500.67 1320.88 1501.93 L1320.88 1498.09 Q1323.17 1497.17 1325.16 1496.7 Q1327.16 1496.23 1328.81 1496.23 Q1333.18 1496.23 1335.77 1498.41 Q1338.37 1500.59 1338.37 1504.24 Q1338.37 1505.97 1337.71 1507.53 Q1337.07 1509.07 1335.36 1511.18 Q1334.89 1511.72 1332.37 1514.34 Q1329.85 1516.93 1325.26 1521.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2022.42 1548.29 L2030.06 1548.29 L2030.06 1521.92 L2021.75 1523.59 L2021.75 1519.33 L2030.02 1517.66 L2034.69 1517.66 L2034.69 1548.29 L2042.33 1548.29 L2042.33 1552.22 L2022.42 1552.22 L2022.42 1548.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2061.78 1520.74 Q2058.16 1520.74 2056.34 1524.31 Q2054.53 1527.85 2054.53 1534.98 Q2054.53 1542.09 2056.34 1545.65 Q2058.16 1549.19 2061.78 1549.19 Q2065.41 1549.19 2067.22 1545.65 Q2069.04 1542.09 2069.04 1534.98 Q2069.04 1527.85 2067.22 1524.31 Q2065.41 1520.74 2061.78 1520.74 M2061.78 1517.04 Q2067.59 1517.04 2070.64 1521.65 Q2073.72 1526.23 2073.72 1534.98 Q2073.72 1543.71 2070.64 1548.31 Q2067.59 1552.9 2061.78 1552.9 Q2055.97 1552.9 2052.89 1548.31 Q2049.83 1543.71 2049.83 1534.98 Q2049.83 1526.23 2052.89 1521.65 Q2055.97 1517.04 2061.78 1517.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2086.41 1509.67 Q2089.14 1510.26 2090.67 1512.1 Q2092.21 1513.94 2092.21 1516.65 Q2092.21 1520.81 2089.35 1523.08 Q2086.49 1525.36 2081.22 1525.36 Q2079.46 1525.36 2077.58 1525 Q2075.71 1524.66 2073.72 1523.97 L2073.72 1520.3 Q2075.3 1521.22 2077.18 1521.69 Q2079.06 1522.16 2081.11 1522.16 Q2084.68 1522.16 2086.55 1520.75 Q2088.43 1519.34 2088.43 1516.65 Q2088.43 1514.17 2086.68 1512.78 Q2084.95 1511.37 2081.84 1511.37 L2078.57 1511.37 L2078.57 1508.24 L2082 1508.24 Q2084.8 1508.24 2086.28 1507.13 Q2087.77 1506.01 2087.77 1503.9 Q2087.77 1501.74 2086.23 1500.59 Q2084.7 1499.42 2081.84 1499.42 Q2080.28 1499.42 2078.5 1499.76 Q2076.71 1500.1 2074.57 1500.82 L2074.57 1497.43 Q2076.73 1496.83 2078.61 1496.53 Q2080.51 1496.23 2082.18 1496.23 Q2086.51 1496.23 2089.03 1498.2 Q2091.55 1500.16 2091.55 1503.51 Q2091.55 1505.84 2090.21 1507.45 Q2088.88 1509.05 2086.41 1509.67 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="189.233,1077.54 2352.76,1077.54 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="189.233,415.207 2352.76,415.207 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,1474.16 189.233,123.472 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,1077.54 208.13,1077.54 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,415.207 208.13,415.207 "></polyline>
<path clip-path="url(#clip650)" d="M51.6634 1097.34 L59.3023 1097.34 L59.3023 1070.97 L50.9921 1072.64 L50.9921 1068.38 L59.256 1066.71 L63.9319 1066.71 L63.9319 1097.34 L71.5707 1097.34 L71.5707 1101.27 L51.6634 1101.27 L51.6634 1097.34 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M91.0151 1069.79 Q87.404 1069.79 85.5753 1073.36 Q83.7697 1076.9 83.7697 1084.03 Q83.7697 1091.13 85.5753 1094.7 Q87.404 1098.24 91.0151 1098.24 Q94.6493 1098.24 96.4548 1094.7 Q98.2835 1091.13 98.2835 1084.03 Q98.2835 1076.9 96.4548 1073.36 Q94.6493 1069.79 91.0151 1069.79 M91.0151 1066.09 Q96.8252 1066.09 99.8808 1070.69 Q102.959 1075.28 102.959 1084.03 Q102.959 1092.75 99.8808 1097.36 Q96.8252 1101.94 91.0151 1101.94 Q85.2049 1101.94 82.1262 1097.36 Q79.0707 1092.75 79.0707 1084.03 Q79.0707 1075.28 82.1262 1070.69 Q85.2049 1066.09 91.0151 1066.09 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M102.959 1060.19 L127.071 1060.19 L127.071 1063.39 L102.959 1063.39 L102.959 1060.19 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M143.866 1058.31 Q141.308 1058.31 139.804 1060.06 Q138.318 1061.81 138.318 1064.85 Q138.318 1067.88 139.804 1069.65 Q141.308 1071.4 143.866 1071.4 Q146.424 1071.4 147.91 1069.65 Q149.415 1067.88 149.415 1064.85 Q149.415 1061.81 147.91 1060.06 Q146.424 1058.31 143.866 1058.31 M151.408 1046.4 L151.408 1049.86 Q149.979 1049.19 148.512 1048.83 Q147.064 1048.47 145.634 1048.47 Q141.873 1048.47 139.879 1051.01 Q137.904 1053.55 137.622 1058.68 Q138.732 1057.05 140.406 1056.18 Q142.08 1055.3 144.092 1055.3 Q148.324 1055.3 150.769 1057.88 Q153.233 1060.43 153.233 1064.85 Q153.233 1069.18 150.675 1071.79 Q148.117 1074.41 143.866 1074.41 Q138.995 1074.41 136.418 1070.68 Q133.842 1066.94 133.842 1059.85 Q133.842 1053.19 137.002 1049.24 Q140.161 1045.27 145.484 1045.27 Q146.913 1045.27 148.361 1045.56 Q149.828 1045.84 151.408 1046.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M52.3217 435 L59.9605 435 L59.9605 408.634 L51.6504 410.301 L51.6504 406.042 L59.9142 404.375 L64.5901 404.375 L64.5901 435 L72.229 435 L72.229 438.935 L52.3217 438.935 L52.3217 435 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M91.6733 407.454 Q88.0622 407.454 86.2335 411.018 Q84.428 414.56 84.428 421.69 Q84.428 428.796 86.2335 432.361 Q88.0622 435.902 91.6733 435.902 Q95.3076 435.902 97.1131 432.361 Q98.9418 428.796 98.9418 421.69 Q98.9418 414.56 97.1131 411.018 Q95.3076 407.454 91.6733 407.454 M91.6733 403.75 Q97.4835 403.75 100.539 408.356 Q103.618 412.94 103.618 421.69 Q103.618 430.416 100.539 435.023 Q97.4835 439.606 91.6733 439.606 Q85.8632 439.606 82.7845 435.023 Q79.729 430.416 79.729 421.69 Q79.729 412.94 82.7845 408.356 Q85.8632 403.75 91.6733 403.75 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M103.618 397.851 L127.729 397.851 L127.729 401.049 L103.618 401.049 L103.618 397.851 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M147.44 396.384 Q150.167 396.967 151.69 398.81 Q153.233 400.654 153.233 403.362 Q153.233 407.518 150.374 409.794 Q147.515 412.07 142.249 412.07 Q140.481 412.07 138.6 411.713 Q136.738 411.374 134.745 410.678 L134.745 407.011 Q136.324 407.932 138.205 408.402 Q140.086 408.873 142.136 408.873 Q145.71 408.873 147.571 407.462 Q149.452 406.051 149.452 403.362 Q149.452 400.879 147.703 399.487 Q145.973 398.077 142.87 398.077 L139.597 398.077 L139.597 394.955 L143.02 394.955 Q145.822 394.955 147.308 393.845 Q148.794 392.717 148.794 390.61 Q148.794 388.447 147.252 387.3 Q145.728 386.134 142.87 386.134 Q141.308 386.134 139.522 386.473 Q137.735 386.811 135.591 387.526 L135.591 384.14 Q137.754 383.538 139.635 383.238 Q141.534 382.937 143.208 382.937 Q147.534 382.937 150.054 384.911 Q152.574 386.867 152.574 390.215 Q152.574 392.547 151.239 394.165 Q149.904 395.764 147.44 396.384 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M499.905 12.096 L512.098 12.096 L527.532 53.2532 L543.047 12.096 L555.24 12.096 L555.24 72.576 L547.26 72.576 L547.26 19.4686 L531.664 60.9499 L523.44 60.9499 L507.844 19.4686 L507.844 72.576 L499.905 72.576 L499.905 12.096 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M571.16 27.2059 L578.614 27.2059 L578.614 72.576 L571.16 72.576 L571.16 27.2059 M571.16 9.54393 L578.614 9.54393 L578.614 18.9825 L571.16 18.9825 L571.16 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M626.86 28.9478 L626.86 35.9153 Q623.7 34.1734 620.5 33.3227 Q617.34 32.4315 614.1 32.4315 Q606.849 32.4315 602.838 37.0496 Q598.828 41.6271 598.828 49.9314 Q598.828 58.2358 602.838 62.8538 Q606.849 67.4314 614.1 67.4314 Q617.34 67.4314 620.5 66.5807 Q623.7 65.6895 626.86 63.9476 L626.86 70.8341 Q623.741 72.2924 620.379 73.0216 Q617.057 73.7508 613.289 73.7508 Q603.041 73.7508 597.005 67.3098 Q590.969 60.8689 590.969 49.9314 Q590.969 38.832 597.045 32.472 Q603.162 26.1121 613.776 26.1121 Q617.219 26.1121 620.5 26.8413 Q623.781 27.5299 626.86 28.9478 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M666.113 34.1734 Q664.857 33.4443 663.359 33.1202 Q661.9 32.7556 660.118 32.7556 Q653.798 32.7556 650.396 36.8875 Q647.033 40.9789 647.033 48.6757 L647.033 72.576 L639.539 72.576 L639.539 27.2059 L647.033 27.2059 L647.033 34.2544 Q649.383 30.1225 653.15 28.1376 Q656.918 26.1121 662.305 26.1121 Q663.075 26.1121 664.007 26.2337 Q664.938 26.3147 666.073 26.5172 L666.113 34.1734 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M689.69 32.4315 Q683.694 32.4315 680.21 37.1306 Q676.727 41.7891 676.727 49.9314 Q676.727 58.0738 680.17 62.7728 Q683.654 67.4314 689.69 67.4314 Q695.644 67.4314 699.128 62.7323 Q702.612 58.0333 702.612 49.9314 Q702.612 41.8701 699.128 37.1711 Q695.644 32.4315 689.69 32.4315 M689.69 26.1121 Q699.412 26.1121 704.961 32.4315 Q710.511 38.7509 710.511 49.9314 Q710.511 61.0714 704.961 67.4314 Q699.412 73.7508 689.69 73.7508 Q679.927 73.7508 674.377 67.4314 Q668.868 61.0714 668.868 49.9314 Q668.868 38.7509 674.377 32.4315 Q679.927 26.1121 689.69 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M720.638 46.5287 L742.473 46.5287 L742.473 53.1722 L720.638 53.1722 L720.638 46.5287 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M773.462 32.4315 Q767.467 32.4315 763.983 37.1306 Q760.499 41.7891 760.499 49.9314 Q760.499 58.0738 763.943 62.7728 Q767.426 67.4314 773.462 67.4314 Q779.417 67.4314 782.901 62.7323 Q786.385 58.0333 786.385 49.9314 Q786.385 41.8701 782.901 37.1711 Q779.417 32.4315 773.462 32.4315 M773.462 26.1121 Q783.184 26.1121 788.734 32.4315 Q794.284 38.7509 794.284 49.9314 Q794.284 61.0714 788.734 67.4314 Q783.184 73.7508 773.462 73.7508 Q763.7 73.7508 758.15 67.4314 Q752.641 61.0714 752.641 49.9314 Q752.641 38.7509 758.15 32.4315 Q763.7 26.1121 773.462 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M813.85 65.7705 L813.85 89.8329 L806.356 89.8329 L806.356 27.2059 L813.85 27.2059 L813.85 34.0924 Q816.199 30.0415 819.764 28.0971 Q823.369 26.1121 828.352 26.1121 Q836.616 26.1121 841.76 32.6746 Q846.946 39.2371 846.946 49.9314 Q846.946 60.6258 841.76 67.1883 Q836.616 73.7508 828.352 73.7508 Q823.369 73.7508 819.764 71.8063 Q816.199 69.8214 813.85 65.7705 M839.208 49.9314 Q839.208 41.7081 835.806 37.0496 Q832.443 32.3505 826.529 32.3505 Q820.615 32.3505 817.212 37.0496 Q813.85 41.7081 813.85 49.9314 Q813.85 58.1548 817.212 62.8538 Q820.615 67.5124 826.529 67.5124 Q832.443 67.5124 835.806 62.8538 Q839.208 58.1548 839.208 49.9314 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M866.674 14.324 L866.674 27.2059 L882.026 27.2059 L882.026 32.9987 L866.674 32.9987 L866.674 57.6282 Q866.674 63.1779 868.172 64.7578 Q869.712 66.3376 874.37 66.3376 L882.026 66.3376 L882.026 72.576 L874.37 72.576 Q865.742 72.576 862.461 69.3758 Q859.179 66.1351 859.179 57.6282 L859.179 32.9987 L853.711 32.9987 L853.711 27.2059 L859.179 27.2059 L859.179 14.324 L866.674 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M891.83 27.2059 L899.283 27.2059 L899.283 72.576 L891.83 72.576 L891.83 27.2059 M891.83 9.54393 L899.283 9.54393 L899.283 18.9825 L891.83 18.9825 L891.83 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M950.203 35.9153 Q952.998 30.8922 956.887 28.5022 Q960.776 26.1121 966.042 26.1121 Q973.131 26.1121 976.98 31.0947 Q980.828 36.0368 980.828 45.1919 L980.828 72.576 L973.334 72.576 L973.334 45.4349 Q973.334 38.913 971.025 35.7533 Q968.716 32.5936 963.976 32.5936 Q958.183 32.5936 954.821 36.4419 Q951.459 40.2903 951.459 46.9338 L951.459 72.576 L943.965 72.576 L943.965 45.4349 Q943.965 38.8725 941.656 35.7533 Q939.347 32.5936 934.526 32.5936 Q928.814 32.5936 925.452 36.4824 Q922.09 40.3308 922.09 46.9338 L922.09 72.576 L914.596 72.576 L914.596 27.2059 L922.09 27.2059 L922.09 34.2544 Q924.642 30.082 928.207 28.0971 Q931.772 26.1121 936.673 26.1121 Q941.615 26.1121 945.059 28.6237 Q948.542 31.1352 950.203 35.9153 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M995.695 27.2059 L1003.15 27.2059 L1003.15 72.576 L995.695 72.576 L995.695 27.2059 M995.695 9.54393 L1003.15 9.54393 L1003.15 18.9825 L995.695 18.9825 L995.695 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1015.5 27.2059 L1050.91 27.2059 L1050.91 34.0114 L1022.88 66.6212 L1050.91 66.6212 L1050.91 72.576 L1014.49 72.576 L1014.49 65.7705 L1042.52 33.1607 L1015.5 33.1607 L1015.5 27.2059 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1082.91 49.7694 Q1073.88 49.7694 1070.39 51.8354 Q1066.91 53.9013 1066.91 58.8839 Q1066.91 62.8538 1069.5 65.2034 Q1072.14 67.5124 1076.63 67.5124 Q1082.83 67.5124 1086.56 63.1374 Q1090.32 58.7219 1090.32 51.4303 L1090.32 49.7694 L1082.91 49.7694 M1097.78 46.6907 L1097.78 72.576 L1090.32 72.576 L1090.32 65.6895 Q1087.77 69.8214 1083.96 71.8063 Q1080.16 73.7508 1074.65 73.7508 Q1067.68 73.7508 1063.55 69.8619 Q1059.46 65.9325 1059.46 59.3701 Q1059.46 51.7138 1064.56 47.825 Q1069.7 43.9361 1079.87 43.9361 L1090.32 43.9361 L1090.32 43.2069 Q1090.32 38.0623 1086.92 35.2672 Q1083.56 32.4315 1077.44 32.4315 Q1073.55 32.4315 1069.87 33.3632 Q1066.18 34.295 1062.78 36.1584 L1062.78 29.2718 Q1066.87 27.692 1070.72 26.9223 Q1074.57 26.1121 1078.21 26.1121 Q1088.06 26.1121 1092.92 31.2163 Q1097.78 36.3204 1097.78 46.6907 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1120.5 14.324 L1120.5 27.2059 L1135.86 27.2059 L1135.86 32.9987 L1120.5 32.9987 L1120.5 57.6282 Q1120.5 63.1779 1122 64.7578 Q1123.54 66.3376 1128.2 66.3376 L1135.86 66.3376 L1135.86 72.576 L1128.2 72.576 Q1119.57 72.576 1116.29 69.3758 Q1113.01 66.1351 1113.01 57.6282 L1113.01 32.9987 L1107.54 32.9987 L1107.54 27.2059 L1113.01 27.2059 L1113.01 14.324 L1120.5 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1145.66 27.2059 L1153.11 27.2059 L1153.11 72.576 L1145.66 72.576 L1145.66 27.2059 M1145.66 9.54393 L1153.11 9.54393 L1153.11 18.9825 L1145.66 18.9825 L1145.66 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1186.29 32.4315 Q1180.29 32.4315 1176.81 37.1306 Q1173.33 41.7891 1173.33 49.9314 Q1173.33 58.0738 1176.77 62.7728 Q1180.25 67.4314 1186.29 67.4314 Q1192.24 67.4314 1195.73 62.7323 Q1199.21 58.0333 1199.21 49.9314 Q1199.21 41.8701 1195.73 37.1711 Q1192.24 32.4315 1186.29 32.4315 M1186.29 26.1121 Q1196.01 26.1121 1201.56 32.4315 Q1207.11 38.7509 1207.11 49.9314 Q1207.11 61.0714 1201.56 67.4314 Q1196.01 73.7508 1186.29 73.7508 Q1176.53 73.7508 1170.98 67.4314 Q1165.47 61.0714 1165.47 49.9314 Q1165.47 38.7509 1170.98 32.4315 Q1176.53 26.1121 1186.29 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1257.18 45.1919 L1257.18 72.576 L1249.73 72.576 L1249.73 45.4349 Q1249.73 38.994 1247.22 35.7938 Q1244.7 32.5936 1239.68 32.5936 Q1233.64 32.5936 1230.16 36.4419 Q1226.68 40.2903 1226.68 46.9338 L1226.68 72.576 L1219.18 72.576 L1219.18 27.2059 L1226.68 27.2059 L1226.68 34.2544 Q1229.35 30.163 1232.96 28.1376 Q1236.6 26.1121 1241.34 26.1121 Q1249.16 26.1121 1253.17 30.9732 Q1257.18 35.7938 1257.18 45.1919 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1300.97 28.5427 L1300.97 35.5912 Q1297.81 33.9709 1294.41 33.1607 Q1291.01 32.3505 1287.36 32.3505 Q1281.81 32.3505 1279.02 34.0519 Q1276.26 35.7533 1276.26 39.156 Q1276.26 41.7486 1278.25 43.2475 Q1280.23 44.7058 1286.23 46.0426 L1288.78 46.6097 Q1296.72 48.3111 1300.04 51.4303 Q1303.4 54.509 1303.4 60.0587 Q1303.4 66.3781 1298.38 70.0644 Q1293.4 73.7508 1284.65 73.7508 Q1281 73.7508 1277.03 73.0216 Q1273.1 72.3329 1268.73 70.9151 L1268.73 63.2184 Q1272.86 65.3654 1276.87 66.4591 Q1280.88 67.5124 1284.81 67.5124 Q1290.07 67.5124 1292.91 65.73 Q1295.75 63.9071 1295.75 60.6258 Q1295.75 57.5877 1293.68 55.9673 Q1291.65 54.3469 1284.73 52.8481 L1282.13 52.2405 Q1275.21 50.7821 1272.13 47.7845 Q1269.05 44.7463 1269.05 39.4801 Q1269.05 33.0797 1273.59 29.5959 Q1278.12 26.1121 1286.47 26.1121 Q1290.6 26.1121 1294.25 26.7198 Q1297.89 27.3274 1300.97 28.5427 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1376.97 35.9153 Q1379.76 30.8922 1383.65 28.5022 Q1387.54 26.1121 1392.8 26.1121 Q1399.89 26.1121 1403.74 31.0947 Q1407.59 36.0368 1407.59 45.1919 L1407.59 72.576 L1400.1 72.576 L1400.1 45.4349 Q1400.1 38.913 1397.79 35.7533 Q1395.48 32.5936 1390.74 32.5936 Q1384.95 32.5936 1381.58 36.4419 Q1378.22 40.2903 1378.22 46.9338 L1378.22 72.576 L1370.73 72.576 L1370.73 45.4349 Q1370.73 38.8725 1368.42 35.7533 Q1366.11 32.5936 1361.29 32.5936 Q1355.58 32.5936 1352.21 36.4824 Q1348.85 40.3308 1348.85 46.9338 L1348.85 72.576 L1341.36 72.576 L1341.36 27.2059 L1348.85 27.2059 L1348.85 34.2544 Q1351.4 30.082 1354.97 28.0971 Q1358.53 26.1121 1363.44 26.1121 Q1368.38 26.1121 1371.82 28.6237 Q1375.31 31.1352 1376.97 35.9153 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1443.08 49.7694 Q1434.04 49.7694 1430.56 51.8354 Q1427.08 53.9013 1427.08 58.8839 Q1427.08 62.8538 1429.67 65.2034 Q1432.3 67.5124 1436.8 67.5124 Q1443 67.5124 1446.72 63.1374 Q1450.49 58.7219 1450.49 51.4303 L1450.49 49.7694 L1443.08 49.7694 M1457.94 46.6907 L1457.94 72.576 L1450.49 72.576 L1450.49 65.6895 Q1447.94 69.8214 1444.13 71.8063 Q1440.32 73.7508 1434.81 73.7508 Q1427.85 73.7508 1423.71 69.8619 Q1419.62 65.9325 1419.62 59.3701 Q1419.62 51.7138 1424.73 47.825 Q1429.87 43.9361 1440.04 43.9361 L1450.49 43.9361 L1450.49 43.2069 Q1450.49 38.0623 1447.09 35.2672 Q1443.72 32.4315 1437.61 32.4315 Q1433.72 32.4315 1430.03 33.3632 Q1426.35 34.295 1422.94 36.1584 L1422.94 29.2718 Q1427.04 27.692 1430.88 26.9223 Q1434.73 26.1121 1438.38 26.1121 Q1448.22 26.1121 1453.08 31.2163 Q1457.94 36.3204 1457.94 46.6907 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1480.67 14.324 L1480.67 27.2059 L1496.02 27.2059 L1496.02 32.9987 L1480.67 32.9987 L1480.67 57.6282 Q1480.67 63.1779 1482.17 64.7578 Q1483.71 66.3376 1488.37 66.3376 L1496.02 66.3376 L1496.02 72.576 L1488.37 72.576 Q1479.74 72.576 1476.46 69.3758 Q1473.17 66.1351 1473.17 57.6282 L1473.17 32.9987 L1467.71 32.9987 L1467.71 27.2059 L1473.17 27.2059 L1473.17 14.324 L1480.67 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1513.2 14.324 L1513.2 27.2059 L1528.55 27.2059 L1528.55 32.9987 L1513.2 32.9987 L1513.2 57.6282 Q1513.2 63.1779 1514.7 64.7578 Q1516.24 66.3376 1520.89 66.3376 L1528.55 66.3376 L1528.55 72.576 L1520.89 72.576 Q1512.27 72.576 1508.98 69.3758 Q1505.7 66.1351 1505.7 57.6282 L1505.7 32.9987 L1500.23 32.9987 L1500.23 27.2059 L1505.7 27.2059 L1505.7 14.324 L1513.2 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1577.16 48.0275 L1577.16 51.6733 L1542.89 51.6733 Q1543.38 59.3701 1547.51 63.421 Q1551.68 67.4314 1559.09 67.4314 Q1563.39 67.4314 1567.4 66.3781 Q1571.45 65.3249 1575.42 63.2184 L1575.42 70.267 Q1571.41 71.9684 1567.2 72.8596 Q1562.98 73.7508 1558.65 73.7508 Q1547.79 73.7508 1541.43 67.4314 Q1535.11 61.1119 1535.11 50.3365 Q1535.11 39.1965 1541.11 32.6746 Q1547.14 26.1121 1557.35 26.1121 Q1566.51 26.1121 1571.81 32.0264 Q1577.16 37.9003 1577.16 48.0275 M1569.71 45.84 Q1569.63 39.7232 1566.26 36.0774 Q1562.94 32.4315 1557.43 32.4315 Q1551.2 32.4315 1547.43 35.9558 Q1543.7 39.4801 1543.13 45.8805 L1569.71 45.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1615.69 34.1734 Q1614.43 33.4443 1612.93 33.1202 Q1611.47 32.7556 1609.69 32.7556 Q1603.37 32.7556 1599.97 36.8875 Q1596.61 40.9789 1596.61 48.6757 L1596.61 72.576 L1589.11 72.576 L1589.11 27.2059 L1596.61 27.2059 L1596.61 34.2544 Q1598.96 30.1225 1602.72 28.1376 Q1606.49 26.1121 1611.88 26.1121 Q1612.65 26.1121 1613.58 26.2337 Q1614.51 26.3147 1615.65 26.5172 L1615.69 34.1734 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1672.84 9.54393 L1672.84 15.7418 L1665.71 15.7418 Q1661.7 15.7418 1660.12 17.3622 Q1658.58 18.9825 1658.58 23.1955 L1658.58 27.2059 L1670.86 27.2059 L1670.86 32.9987 L1658.58 32.9987 L1658.58 72.576 L1651.09 72.576 L1651.09 32.9987 L1643.96 32.9987 L1643.96 27.2059 L1651.09 27.2059 L1651.09 24.0462 Q1651.09 16.471 1654.61 13.0277 Q1658.14 9.54393 1665.8 9.54393 L1672.84 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1696.66 32.4315 Q1690.67 32.4315 1687.18 37.1306 Q1683.7 41.7891 1683.7 49.9314 Q1683.7 58.0738 1687.14 62.7728 Q1690.63 67.4314 1696.66 67.4314 Q1702.62 67.4314 1706.1 62.7323 Q1709.59 58.0333 1709.59 49.9314 Q1709.59 41.8701 1706.1 37.1711 Q1702.62 32.4315 1696.66 32.4315 M1696.66 26.1121 Q1706.39 26.1121 1711.94 32.4315 Q1717.48 38.7509 1717.48 49.9314 Q1717.48 61.0714 1711.94 67.4314 Q1706.39 73.7508 1696.66 73.7508 Q1686.9 73.7508 1681.35 67.4314 Q1675.84 61.0714 1675.84 49.9314 Q1675.84 38.7509 1681.35 32.4315 Q1686.9 26.1121 1696.66 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1756.13 34.1734 Q1754.87 33.4443 1753.38 33.1202 Q1751.92 32.7556 1750.14 32.7556 Q1743.82 32.7556 1740.41 36.8875 Q1737.05 40.9789 1737.05 48.6757 L1737.05 72.576 L1729.56 72.576 L1729.56 27.2059 L1737.05 27.2059 L1737.05 34.2544 Q1739.4 30.1225 1743.17 28.1376 Q1746.93 26.1121 1752.32 26.1121 Q1753.09 26.1121 1754.02 26.2337 Q1754.96 26.3147 1756.09 26.5172 L1756.13 34.1734 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1798.83 43.6931 L1798.83 65.8515 L1811.95 65.8515 Q1818.55 65.8515 1821.71 63.1374 Q1824.91 60.3828 1824.91 54.752 Q1824.91 49.0808 1821.71 46.4072 Q1818.55 43.6931 1811.95 43.6931 L1798.83 43.6931 M1798.83 18.8205 L1798.83 37.0496 L1810.94 37.0496 Q1816.93 37.0496 1819.85 34.8216 Q1822.81 32.5531 1822.81 27.935 Q1822.81 23.3575 1819.85 21.089 Q1816.93 18.8205 1810.94 18.8205 L1798.83 18.8205 M1790.64 12.096 L1811.55 12.096 Q1820.9 12.096 1825.97 15.9849 Q1831.03 19.8737 1831.03 27.0438 Q1831.03 32.5936 1828.44 35.8748 Q1825.85 39.156 1820.82 39.9662 Q1826.86 41.2625 1830.18 45.3944 Q1833.54 49.4858 1833.54 55.6432 Q1833.54 63.745 1828.03 68.1605 Q1822.52 72.576 1812.36 72.576 L1790.64 72.576 L1790.64 12.096 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1847.56 12.096 L1855.74 12.096 L1855.74 65.6895 L1885.19 65.6895 L1885.19 72.576 L1847.56 72.576 L1847.56 12.096 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1915.9 20.1573 L1904.8 50.2555 L1927.04 50.2555 L1915.9 20.1573 M1911.28 12.096 L1920.56 12.096 L1943.61 72.576 L1935.1 72.576 L1929.59 57.061 L1902.33 57.061 L1896.82 72.576 L1888.19 72.576 L1911.28 12.096 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1988.69 14.0809 L1988.69 22.0612 Q1984.03 19.8332 1979.9 18.7395 Q1975.77 17.6457 1971.92 17.6457 Q1965.24 17.6457 1961.59 20.2383 Q1957.99 22.8309 1957.99 27.611 Q1957.99 31.6214 1960.38 33.6873 Q1962.81 35.7128 1969.53 36.9686 L1974.47 37.9813 Q1983.63 39.7232 1987.96 44.1387 Q1992.34 48.5136 1992.34 55.8863 Q1992.34 64.6767 1986.42 69.2137 Q1980.55 73.7508 1969.17 73.7508 Q1964.87 73.7508 1960.01 72.7785 Q1955.19 71.8063 1950.01 69.9024 L1950.01 61.4765 Q1954.99 64.2716 1959.77 65.6895 Q1964.55 67.1073 1969.17 67.1073 Q1976.18 67.1073 1979.98 64.3527 Q1983.79 61.598 1983.79 56.4939 Q1983.79 52.0379 1981.04 49.5264 Q1978.32 47.0148 1972.08 45.759 L1967.1 44.7868 Q1957.95 42.9639 1953.86 39.075 Q1949.76 35.1862 1949.76 28.2591 Q1949.76 20.2383 1955.39 15.6203 Q1961.07 11.0023 1970.99 11.0023 Q1975.24 11.0023 1979.66 11.7719 Q1984.07 12.5416 1988.69 14.0809 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2007.25 65.6895 L2020.61 65.6895 L2020.61 19.5497 L2006.07 22.4663 L2006.07 15.0127 L2020.53 12.096 L2028.72 12.096 L2028.72 65.6895 L2042.08 65.6895 L2042.08 72.576 L2007.25 72.576 L2007.25 65.6895 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip652)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="250.464,1366.48 477.249,1321.77 704.033,1197.79 930.818,1121.86 1157.6,1040.55 1384.39,865.724 1611.17,752.31 1837.96,597.3 2064.74,422.769 2291.52,161.699 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="250.464,1435.94 477.249,1351.69 704.033,1316.94 930.818,1230.66 1157.6,1079.71 1384.39,911.99 1611.17,763.387 1837.96,633.103 2064.74,439.132 2291.52,279.529 "></polyline>
<path clip-path="url(#clip650)" d="M2019.59 1429.14 L2280.64 1429.14 L2280.64 1273.62 L2019.59 1273.62  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2019.59,1429.14 2280.64,1429.14 2280.64,1273.62 2019.59,1273.62 2019.59,1429.14 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2043.63,1325.46 2187.86,1325.46 "></polyline>
<path clip-path="url(#clip650)" d="M2211.9 1321.21 L2241.58 1321.21 L2241.58 1325.1 L2211.9 1325.1 L2211.9 1321.21 M2211.9 1330.66 L2241.58 1330.66 L2241.58 1334.59 L2211.9 1334.59 L2211.9 1330.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip650)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2043.63,1377.3 2187.86,1377.3 "></polyline>
<path clip-path="url(#clip650)" d="M2211.9 1388.7 L2216.78 1388.7 L2216.78 1394.58 L2211.9 1394.58 L2211.9 1388.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2226.92 1373.05 L2256.6 1373.05 L2256.6 1376.94 L2226.92 1376.94 L2226.92 1373.05 M2226.92 1382.5 L2256.6 1382.5 L2256.6 1386.43 L2226.92 1386.43 L2226.92 1382.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path></svg>
</div>
</div>
<p>However, when the computation takes O(n^3), like in matrix multiplications, the high constant factor only comes into play when the matrices are sufficiently small:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span>, <span class="bu">BenchmarkTools</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">alloc_timer</span>(n)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> <span class="fu">rand</span>(n, n)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> <span class="fu">rand</span>(n, n)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> <span class="fu">rand</span>(n, n)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    t1 <span class="op">=</span> <span class="pp">@belapsed</span> <span class="op">$</span>A<span class="op">*$</span>B</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    t2 <span class="op">=</span> <span class="pp">@belapsed</span> <span class="fu">mul!</span>(<span class="op">$</span>C,<span class="op">$</span>A,<span class="op">$</span>B)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    t1,t2</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>ns <span class="op">=</span> <span class="fl">2</span> <span class="op">.^</span> (<span class="fl">2</span><span class="op">:</span><span class="fl">7</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> [<span class="fu">alloc_timer</span>(n) for n <span class="kw">in</span> ns]</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>alloc   <span class="op">=</span> [x[<span class="fl">1</span>] for x <span class="kw">in</span> res]</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>noalloc <span class="op">=</span> [x[<span class="fl">2</span>] for x <span class="kw">in</span> res]</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ns, alloc;</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>     label <span class="op">=</span> <span class="st">"*"</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>     xscale <span class="op">=</span> <span class="op">:</span>log10,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>     yscale <span class="op">=</span> <span class="op">:</span>log10,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>     legend <span class="op">=</span> <span class="op">:</span>bottomright,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>     title <span class="op">=</span> <span class="st">"Micro-optimizations only matter for small matmuls"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(ns, noalloc; label <span class="op">=</span> <span class="st">"mul!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewbox="0 0 2400 1600">
<defs>
  <clippath id="clip740">
    <rect x="0" y="0" width="2400" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip740)" d="M0 1600 L2400 1600 L2400 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip741">
    <rect x="480" y="0" width="1681" height="1600"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip740)" d="M189.233 1474.16 L2352.76 1474.16 L2352.76 123.472 L189.233 123.472  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip742">
    <rect x="189" y="123" width="2165" height="1352"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip742)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="790.091,1474.16 790.091,123.472 "></polyline>
<polyline clip-path="url(#clip742)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2146.14,1474.16 2146.14,123.472 "></polyline>
<polyline clip-path="url(#clip740)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,1474.16 2352.76,1474.16 "></polyline>
<polyline clip-path="url(#clip740)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="790.091,1474.16 790.091,1455.27 "></polyline>
<polyline clip-path="url(#clip740)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2146.14,1474.16 2146.14,1455.27 "></polyline>
<path clip-path="url(#clip740)" d="M756.419 1548.29 L764.058 1548.29 L764.058 1521.92 L755.748 1523.59 L755.748 1519.33 L764.011 1517.66 L768.687 1517.66 L768.687 1548.29 L776.326 1548.29 L776.326 1552.22 L756.419 1552.22 L756.419 1548.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M795.77 1520.74 Q792.159 1520.74 790.331 1524.31 Q788.525 1527.85 788.525 1534.98 Q788.525 1542.09 790.331 1545.65 Q792.159 1549.19 795.77 1549.19 Q799.405 1549.19 801.21 1545.65 Q803.039 1542.09 803.039 1534.98 Q803.039 1527.85 801.21 1524.31 Q799.405 1520.74 795.77 1520.74 M795.77 1517.04 Q801.581 1517.04 804.636 1521.65 Q807.715 1526.23 807.715 1534.98 Q807.715 1543.71 804.636 1548.31 Q801.581 1552.9 795.77 1552.9 Q789.96 1552.9 786.882 1548.31 Q783.826 1543.71 783.826 1534.98 Q783.826 1526.23 786.882 1521.65 Q789.96 1517.04 795.77 1517.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M808.26 1521.62 L814.467 1521.62 L814.467 1500.19 L807.715 1501.55 L807.715 1498.09 L814.429 1496.73 L818.228 1496.73 L818.228 1521.62 L824.435 1521.62 L824.435 1524.81 L808.26 1524.81 L808.26 1521.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2111.91 1548.29 L2119.55 1548.29 L2119.55 1521.92 L2111.24 1523.59 L2111.24 1519.33 L2119.51 1517.66 L2124.18 1517.66 L2124.18 1548.29 L2131.82 1548.29 L2131.82 1552.22 L2111.91 1552.22 L2111.91 1548.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2151.27 1520.74 Q2147.66 1520.74 2145.83 1524.31 Q2144.02 1527.85 2144.02 1534.98 Q2144.02 1542.09 2145.83 1545.65 Q2147.66 1549.19 2151.27 1549.19 Q2154.9 1549.19 2156.71 1545.65 Q2158.53 1542.09 2158.53 1534.98 Q2158.53 1527.85 2156.71 1524.31 Q2154.9 1520.74 2151.27 1520.74 M2151.27 1517.04 Q2157.08 1517.04 2160.13 1521.65 Q2163.21 1526.23 2163.21 1534.98 Q2163.21 1543.71 2160.13 1548.31 Q2157.08 1552.9 2151.27 1552.9 Q2145.46 1552.9 2142.38 1548.31 Q2139.32 1543.71 2139.32 1534.98 Q2139.32 1526.23 2142.38 1521.65 Q2145.46 1517.04 2151.27 1517.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2167.78 1521.62 L2181.04 1521.62 L2181.04 1524.81 L2163.21 1524.81 L2163.21 1521.62 Q2165.37 1519.38 2169.1 1515.62 Q2172.84 1511.84 2173.8 1510.75 Q2175.62 1508.7 2176.34 1507.29 Q2177.07 1505.86 2177.07 1504.48 Q2177.07 1502.24 2175.49 1500.83 Q2173.93 1499.42 2171.41 1499.42 Q2169.62 1499.42 2167.63 1500.04 Q2165.66 1500.67 2163.4 1501.93 L2163.4 1498.09 Q2165.69 1497.17 2167.69 1496.7 Q2169.68 1496.23 2171.34 1496.23 Q2175.7 1496.23 2178.29 1498.41 Q2180.89 1500.59 2180.89 1504.24 Q2180.89 1505.97 2180.23 1507.53 Q2179.59 1509.07 2177.88 1511.18 Q2177.41 1511.72 2174.89 1514.34 Q2172.37 1516.93 2167.78 1521.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip742)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="189.233,1019.91 2352.76,1019.91 "></polyline>
<polyline clip-path="url(#clip742)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="189.233,537.844 2352.76,537.844 "></polyline>
<polyline clip-path="url(#clip740)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,1474.16 189.233,123.472 "></polyline>
<polyline clip-path="url(#clip740)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,1019.91 208.13,1019.91 "></polyline>
<polyline clip-path="url(#clip740)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="189.233,537.844 208.13,537.844 "></polyline>
<path clip-path="url(#clip740)" d="M51.6634 1039.7 L59.3023 1039.7 L59.3023 1013.34 L50.9921 1015 L50.9921 1010.75 L59.256 1009.08 L63.9319 1009.08 L63.9319 1039.7 L71.5707 1039.7 L71.5707 1043.64 L51.6634 1043.64 L51.6634 1039.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M91.0151 1012.16 Q87.404 1012.16 85.5753 1015.72 Q83.7697 1019.26 83.7697 1026.39 Q83.7697 1033.5 85.5753 1037.06 Q87.404 1040.61 91.0151 1040.61 Q94.6493 1040.61 96.4548 1037.06 Q98.2835 1033.5 98.2835 1026.39 Q98.2835 1019.26 96.4548 1015.72 Q94.6493 1012.16 91.0151 1012.16 M91.0151 1008.45 Q96.8252 1008.45 99.8808 1013.06 Q102.959 1017.64 102.959 1026.39 Q102.959 1035.12 99.8808 1039.73 Q96.8252 1044.31 91.0151 1044.31 Q85.2049 1044.31 82.1262 1039.73 Q79.0707 1035.12 79.0707 1026.39 Q79.0707 1017.64 82.1262 1013.06 Q85.2049 1008.45 91.0151 1008.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M102.959 1002.55 L127.071 1002.55 L127.071 1005.75 L102.959 1005.75 L102.959 1002.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M143.866 1000.67 Q141.308 1000.67 139.804 1002.42 Q138.318 1004.17 138.318 1007.22 Q138.318 1010.25 139.804 1012.02 Q141.308 1013.76 143.866 1013.76 Q146.424 1013.76 147.91 1012.02 Q149.415 1010.25 149.415 1007.22 Q149.415 1004.17 147.91 1002.42 Q146.424 1000.67 143.866 1000.67 M151.408 988.769 L151.408 992.229 Q149.979 991.552 148.512 991.195 Q147.064 990.838 145.634 990.838 Q141.873 990.838 139.879 993.377 Q137.904 995.916 137.622 1001.05 Q138.732 999.414 140.406 998.549 Q142.08 997.665 144.092 997.665 Q148.324 997.665 150.769 1000.24 Q153.233 1002.8 153.233 1007.22 Q153.233 1011.55 150.675 1014.16 Q148.117 1016.77 143.866 1016.77 Q138.995 1016.77 136.418 1013.05 Q133.842 1009.31 133.842 1002.22 Q133.842 995.558 137.002 991.609 Q140.161 987.64 145.484 987.64 Q146.913 987.64 148.361 987.923 Q149.828 988.205 151.408 988.769 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M52.6038 557.636 L60.2427 557.636 L60.2427 531.271 L51.9325 532.937 L51.9325 528.678 L60.1964 527.011 L64.8723 527.011 L64.8723 557.636 L72.5111 557.636 L72.5111 561.571 L52.6038 561.571 L52.6038 557.636 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M91.9554 530.09 Q88.3444 530.09 86.5157 533.655 Q84.7101 537.197 84.7101 544.326 Q84.7101 551.433 86.5157 554.997 Q88.3444 558.539 91.9554 558.539 Q95.5897 558.539 97.3952 554.997 Q99.2239 551.433 99.2239 544.326 Q99.2239 537.197 97.3952 533.655 Q95.5897 530.09 91.9554 530.09 M91.9554 526.386 Q97.7656 526.386 100.821 530.993 Q103.9 535.576 103.9 544.326 Q103.9 553.053 100.821 557.659 Q97.7656 562.243 91.9554 562.243 Q86.1453 562.243 83.0666 557.659 Q80.0111 553.053 80.0111 544.326 Q80.0111 535.576 83.0666 530.993 Q86.1453 526.386 91.9554 526.386 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M103.9 520.488 L128.011 520.488 L128.011 523.685 L103.9 523.685 L103.9 520.488 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M136.249 506.081 L151.164 506.081 L151.164 509.278 L139.729 509.278 L139.729 516.162 Q140.556 515.88 141.384 515.748 Q142.211 515.598 143.039 515.598 Q147.741 515.598 150.487 518.174 Q153.233 520.751 153.233 525.152 Q153.233 529.685 150.411 532.205 Q147.59 534.706 142.456 534.706 Q140.688 534.706 138.845 534.406 Q137.02 534.105 135.064 533.503 L135.064 529.685 Q136.757 530.606 138.563 531.058 Q140.368 531.509 142.381 531.509 Q145.634 531.509 147.534 529.798 Q149.433 528.086 149.433 525.152 Q149.433 522.218 147.534 520.507 Q145.634 518.795 142.381 518.795 Q140.857 518.795 139.334 519.134 Q137.829 519.472 136.249 520.187 L136.249 506.081 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M225.193 12.096 L237.386 12.096 L252.82 53.2532 L268.335 12.096 L280.528 12.096 L280.528 72.576 L272.548 72.576 L272.548 19.4686 L256.952 60.9499 L248.728 60.9499 L233.132 19.4686 L233.132 72.576 L225.193 72.576 L225.193 12.096 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M296.448 27.2059 L303.902 27.2059 L303.902 72.576 L296.448 72.576 L296.448 27.2059 M296.448 9.54393 L303.902 9.54393 L303.902 18.9825 L296.448 18.9825 L296.448 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M352.148 28.9478 L352.148 35.9153 Q348.988 34.1734 345.788 33.3227 Q342.628 32.4315 339.388 32.4315 Q332.136 32.4315 328.126 37.0496 Q324.116 41.6271 324.116 49.9314 Q324.116 58.2358 328.126 62.8538 Q332.136 67.4314 339.388 67.4314 Q342.628 67.4314 345.788 66.5807 Q348.988 65.6895 352.148 63.9476 L352.148 70.8341 Q349.029 72.2924 345.666 73.0216 Q342.345 73.7508 338.577 73.7508 Q328.329 73.7508 322.293 67.3098 Q316.257 60.8689 316.257 49.9314 Q316.257 38.832 322.333 32.472 Q328.45 26.1121 339.063 26.1121 Q342.507 26.1121 345.788 26.8413 Q349.069 27.5299 352.148 28.9478 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M391.401 34.1734 Q390.145 33.4443 388.647 33.1202 Q387.188 32.7556 385.406 32.7556 Q379.086 32.7556 375.684 36.8875 Q372.321 40.9789 372.321 48.6757 L372.321 72.576 L364.827 72.576 L364.827 27.2059 L372.321 27.2059 L372.321 34.2544 Q374.671 30.1225 378.438 28.1376 Q382.206 26.1121 387.593 26.1121 Q388.363 26.1121 389.295 26.2337 Q390.226 26.3147 391.361 26.5172 L391.401 34.1734 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M414.977 32.4315 Q408.982 32.4315 405.498 37.1306 Q402.015 41.7891 402.015 49.9314 Q402.015 58.0738 405.458 62.7728 Q408.942 67.4314 414.977 67.4314 Q420.932 67.4314 424.416 62.7323 Q427.9 58.0333 427.9 49.9314 Q427.9 41.8701 424.416 37.1711 Q420.932 32.4315 414.977 32.4315 M414.977 26.1121 Q424.7 26.1121 430.249 32.4315 Q435.799 38.7509 435.799 49.9314 Q435.799 61.0714 430.249 67.4314 Q424.7 73.7508 414.977 73.7508 Q405.215 73.7508 399.665 67.4314 Q394.156 61.0714 394.156 49.9314 Q394.156 38.7509 399.665 32.4315 Q405.215 26.1121 414.977 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M445.926 46.5287 L467.761 46.5287 L467.761 53.1722 L445.926 53.1722 L445.926 46.5287 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M498.75 32.4315 Q492.755 32.4315 489.271 37.1306 Q485.787 41.7891 485.787 49.9314 Q485.787 58.0738 489.231 62.7728 Q492.714 67.4314 498.75 67.4314 Q504.705 67.4314 508.189 62.7323 Q511.673 58.0333 511.673 49.9314 Q511.673 41.8701 508.189 37.1711 Q504.705 32.4315 498.75 32.4315 M498.75 26.1121 Q508.472 26.1121 514.022 32.4315 Q519.572 38.7509 519.572 49.9314 Q519.572 61.0714 514.022 67.4314 Q508.472 73.7508 498.75 73.7508 Q488.987 73.7508 483.438 67.4314 Q477.928 61.0714 477.928 49.9314 Q477.928 38.7509 483.438 32.4315 Q488.987 26.1121 498.75 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M539.138 65.7705 L539.138 89.8329 L531.643 89.8329 L531.643 27.2059 L539.138 27.2059 L539.138 34.0924 Q541.487 30.0415 545.052 28.0971 Q548.657 26.1121 553.64 26.1121 Q561.904 26.1121 567.048 32.6746 Q572.234 39.2371 572.234 49.9314 Q572.234 60.6258 567.048 67.1883 Q561.904 73.7508 553.64 73.7508 Q548.657 73.7508 545.052 71.8063 Q541.487 69.8214 539.138 65.7705 M564.496 49.9314 Q564.496 41.7081 561.094 37.0496 Q557.731 32.3505 551.817 32.3505 Q545.903 32.3505 542.5 37.0496 Q539.138 41.7081 539.138 49.9314 Q539.138 58.1548 542.5 62.8538 Q545.903 67.5124 551.817 67.5124 Q557.731 67.5124 561.094 62.8538 Q564.496 58.1548 564.496 49.9314 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M591.961 14.324 L591.961 27.2059 L607.314 27.2059 L607.314 32.9987 L591.961 32.9987 L591.961 57.6282 Q591.961 63.1779 593.46 64.7578 Q595 66.3376 599.658 66.3376 L607.314 66.3376 L607.314 72.576 L599.658 72.576 Q591.03 72.576 587.748 69.3758 Q584.467 66.1351 584.467 57.6282 L584.467 32.9987 L578.999 32.9987 L578.999 27.2059 L584.467 27.2059 L584.467 14.324 L591.961 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M617.118 27.2059 L624.571 27.2059 L624.571 72.576 L617.118 72.576 L617.118 27.2059 M617.118 9.54393 L624.571 9.54393 L624.571 18.9825 L617.118 18.9825 L617.118 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M675.491 35.9153 Q678.286 30.8922 682.175 28.5022 Q686.064 26.1121 691.33 26.1121 Q698.419 26.1121 702.268 31.0947 Q706.116 36.0368 706.116 45.1919 L706.116 72.576 L698.622 72.576 L698.622 45.4349 Q698.622 38.913 696.313 35.7533 Q694.004 32.5936 689.264 32.5936 Q683.471 32.5936 680.109 36.4419 Q676.747 40.2903 676.747 46.9338 L676.747 72.576 L669.253 72.576 L669.253 45.4349 Q669.253 38.8725 666.944 35.7533 Q664.635 32.5936 659.814 32.5936 Q654.102 32.5936 650.74 36.4824 Q647.378 40.3308 647.378 46.9338 L647.378 72.576 L639.884 72.576 L639.884 27.2059 L647.378 27.2059 L647.378 34.2544 Q649.93 30.082 653.495 28.0971 Q657.059 26.1121 661.961 26.1121 Q666.903 26.1121 670.346 28.6237 Q673.83 31.1352 675.491 35.9153 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M720.983 27.2059 L728.436 27.2059 L728.436 72.576 L720.983 72.576 L720.983 27.2059 M720.983 9.54393 L728.436 9.54393 L728.436 18.9825 L720.983 18.9825 L720.983 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M740.792 27.2059 L776.197 27.2059 L776.197 34.0114 L748.164 66.6212 L776.197 66.6212 L776.197 72.576 L739.779 72.576 L739.779 65.7705 L767.811 33.1607 L740.792 33.1607 L740.792 27.2059 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M808.199 49.7694 Q799.165 49.7694 795.681 51.8354 Q792.198 53.9013 792.198 58.8839 Q792.198 62.8538 794.79 65.2034 Q797.423 67.5124 801.92 67.5124 Q808.118 67.5124 811.845 63.1374 Q815.612 58.7219 815.612 51.4303 L815.612 49.7694 L808.199 49.7694 M823.066 46.6907 L823.066 72.576 L815.612 72.576 L815.612 65.6895 Q813.06 69.8214 809.252 71.8063 Q805.444 73.7508 799.935 73.7508 Q792.967 73.7508 788.835 69.8619 Q784.744 65.9325 784.744 59.3701 Q784.744 51.7138 789.848 47.825 Q794.993 43.9361 805.161 43.9361 L815.612 43.9361 L815.612 43.2069 Q815.612 38.0623 812.209 35.2672 Q808.847 32.4315 802.73 32.4315 Q798.841 32.4315 795.155 33.3632 Q791.468 34.295 788.066 36.1584 L788.066 29.2718 Q792.157 27.692 796.005 26.9223 Q799.854 26.1121 803.5 26.1121 Q813.343 26.1121 818.204 31.2163 Q823.066 36.3204 823.066 46.6907 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M845.791 14.324 L845.791 27.2059 L861.144 27.2059 L861.144 32.9987 L845.791 32.9987 L845.791 57.6282 Q845.791 63.1779 847.29 64.7578 Q848.829 66.3376 853.488 66.3376 L861.144 66.3376 L861.144 72.576 L853.488 72.576 Q844.859 72.576 841.578 69.3758 Q838.297 66.1351 838.297 57.6282 L838.297 32.9987 L832.828 32.9987 L832.828 27.2059 L838.297 27.2059 L838.297 14.324 L845.791 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M870.947 27.2059 L878.401 27.2059 L878.401 72.576 L870.947 72.576 L870.947 27.2059 M870.947 9.54393 L878.401 9.54393 L878.401 18.9825 L870.947 18.9825 L870.947 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M911.578 32.4315 Q905.582 32.4315 902.099 37.1306 Q898.615 41.7891 898.615 49.9314 Q898.615 58.0738 902.058 62.7728 Q905.542 67.4314 911.578 67.4314 Q917.533 67.4314 921.016 62.7323 Q924.5 58.0333 924.5 49.9314 Q924.5 41.8701 921.016 37.1711 Q917.533 32.4315 911.578 32.4315 M911.578 26.1121 Q921.3 26.1121 926.85 32.4315 Q932.399 38.7509 932.399 49.9314 Q932.399 61.0714 926.85 67.4314 Q921.3 73.7508 911.578 73.7508 Q901.815 73.7508 896.265 67.4314 Q890.756 61.0714 890.756 49.9314 Q890.756 38.7509 896.265 32.4315 Q901.815 26.1121 911.578 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M982.469 45.1919 L982.469 72.576 L975.015 72.576 L975.015 45.4349 Q975.015 38.994 972.503 35.7938 Q969.992 32.5936 964.969 32.5936 Q958.933 32.5936 955.449 36.4419 Q951.965 40.2903 951.965 46.9338 L951.965 72.576 L944.471 72.576 L944.471 27.2059 L951.965 27.2059 L951.965 34.2544 Q954.639 30.163 958.244 28.1376 Q961.89 26.1121 966.63 26.1121 Q974.448 26.1121 978.458 30.9732 Q982.469 35.7938 982.469 45.1919 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1026.26 28.5427 L1026.26 35.5912 Q1023.1 33.9709 1019.7 33.1607 Q1016.29 32.3505 1012.65 32.3505 Q1007.1 32.3505 1004.3 34.0519 Q1001.55 35.7533 1001.55 39.156 Q1001.55 41.7486 1003.53 43.2475 Q1005.52 44.7058 1011.51 46.0426 L1014.07 46.6097 Q1022.01 48.3111 1025.33 51.4303 Q1028.69 54.509 1028.69 60.0587 Q1028.69 66.3781 1023.67 70.0644 Q1018.68 73.7508 1009.93 73.7508 Q1006.29 73.7508 1002.32 73.0216 Q998.389 72.3329 994.014 70.9151 L994.014 63.2184 Q998.146 65.3654 1002.16 66.4591 Q1006.17 67.5124 1010.1 67.5124 Q1015.36 67.5124 1018.2 65.73 Q1021.03 63.9071 1021.03 60.6258 Q1021.03 57.5877 1018.97 55.9673 Q1016.94 54.3469 1010.01 52.8481 L1007.42 52.2405 Q1000.5 50.7821 997.416 47.7845 Q994.338 44.7463 994.338 39.4801 Q994.338 33.0797 998.875 29.5959 Q1003.41 26.1121 1011.76 26.1121 Q1015.89 26.1121 1019.53 26.7198 Q1023.18 27.3274 1026.26 28.5427 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1084.51 32.4315 Q1078.52 32.4315 1075.03 37.1306 Q1071.55 41.7891 1071.55 49.9314 Q1071.55 58.0738 1074.99 62.7728 Q1078.48 67.4314 1084.51 67.4314 Q1090.47 67.4314 1093.95 62.7323 Q1097.43 58.0333 1097.43 49.9314 Q1097.43 41.8701 1093.95 37.1711 Q1090.47 32.4315 1084.51 32.4315 M1084.51 26.1121 Q1094.23 26.1121 1099.78 32.4315 Q1105.33 38.7509 1105.33 49.9314 Q1105.33 61.0714 1099.78 67.4314 Q1094.23 73.7508 1084.51 73.7508 Q1074.75 73.7508 1069.2 67.4314 Q1063.69 61.0714 1063.69 49.9314 Q1063.69 38.7509 1069.2 32.4315 Q1074.75 26.1121 1084.51 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1155.4 45.1919 L1155.4 72.576 L1147.95 72.576 L1147.95 45.4349 Q1147.95 38.994 1145.44 35.7938 Q1142.92 32.5936 1137.9 32.5936 Q1131.87 32.5936 1128.38 36.4419 Q1124.9 40.2903 1124.9 46.9338 L1124.9 72.576 L1117.4 72.576 L1117.4 27.2059 L1124.9 27.2059 L1124.9 34.2544 Q1127.57 30.163 1131.18 28.1376 Q1134.82 26.1121 1139.56 26.1121 Q1147.38 26.1121 1151.39 30.9732 Q1155.4 35.7938 1155.4 45.1919 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1170.27 9.54393 L1177.72 9.54393 L1177.72 72.576 L1170.27 72.576 L1170.27 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1212.2 76.7889 Q1209.04 84.8907 1206.04 87.3618 Q1203.04 89.8329 1198.02 89.8329 L1192.06 89.8329 L1192.06 83.5945 L1196.44 83.5945 Q1199.52 83.5945 1201.22 82.1361 Q1202.92 80.6778 1204.98 75.2496 L1206.32 71.8468 L1187.97 27.2059 L1195.87 27.2059 L1210.05 62.6918 L1224.23 27.2059 L1232.13 27.2059 L1212.2 76.7889 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1304.11 35.9153 Q1306.91 30.8922 1310.79 28.5022 Q1314.68 26.1121 1319.95 26.1121 Q1327.04 26.1121 1330.89 31.0947 Q1334.74 36.0368 1334.74 45.1919 L1334.74 72.576 L1327.24 72.576 L1327.24 45.4349 Q1327.24 38.913 1324.93 35.7533 Q1322.62 32.5936 1317.88 32.5936 Q1312.09 32.5936 1308.73 36.4419 Q1305.37 40.2903 1305.37 46.9338 L1305.37 72.576 L1297.87 72.576 L1297.87 45.4349 Q1297.87 38.8725 1295.56 35.7533 Q1293.25 32.5936 1288.43 32.5936 Q1282.72 32.5936 1279.36 36.4824 Q1276 40.3308 1276 46.9338 L1276 72.576 L1268.5 72.576 L1268.5 27.2059 L1276 27.2059 L1276 34.2544 Q1278.55 30.082 1282.11 28.0971 Q1285.68 26.1121 1290.58 26.1121 Q1295.52 26.1121 1298.97 28.6237 Q1302.45 31.1352 1304.11 35.9153 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1370.22 49.7694 Q1361.19 49.7694 1357.7 51.8354 Q1354.22 53.9013 1354.22 58.8839 Q1354.22 62.8538 1356.81 65.2034 Q1359.45 67.5124 1363.94 67.5124 Q1370.14 67.5124 1373.87 63.1374 Q1377.63 58.7219 1377.63 51.4303 L1377.63 49.7694 L1370.22 49.7694 M1385.09 46.6907 L1385.09 72.576 L1377.63 72.576 L1377.63 65.6895 Q1375.08 69.8214 1371.27 71.8063 Q1367.47 73.7508 1361.96 73.7508 Q1354.99 73.7508 1350.86 69.8619 Q1346.77 65.9325 1346.77 59.3701 Q1346.77 51.7138 1351.87 47.825 Q1357.02 43.9361 1367.18 43.9361 L1377.63 43.9361 L1377.63 43.2069 Q1377.63 38.0623 1374.23 35.2672 Q1370.87 32.4315 1364.75 32.4315 Q1360.86 32.4315 1357.18 33.3632 Q1353.49 34.295 1350.09 36.1584 L1350.09 29.2718 Q1354.18 27.692 1358.03 26.9223 Q1361.88 26.1121 1365.52 26.1121 Q1375.37 26.1121 1380.23 31.2163 Q1385.09 36.3204 1385.09 46.6907 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1407.81 14.324 L1407.81 27.2059 L1423.17 27.2059 L1423.17 32.9987 L1407.81 32.9987 L1407.81 57.6282 Q1407.81 63.1779 1409.31 64.7578 Q1410.85 66.3376 1415.51 66.3376 L1423.17 66.3376 L1423.17 72.576 L1415.51 72.576 Q1406.88 72.576 1403.6 69.3758 Q1400.32 66.1351 1400.32 57.6282 L1400.32 32.9987 L1394.85 32.9987 L1394.85 27.2059 L1400.32 27.2059 L1400.32 14.324 L1407.81 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1440.34 14.324 L1440.34 27.2059 L1455.7 27.2059 L1455.7 32.9987 L1440.34 32.9987 L1440.34 57.6282 Q1440.34 63.1779 1441.84 64.7578 Q1443.38 66.3376 1448.04 66.3376 L1455.7 66.3376 L1455.7 72.576 L1448.04 72.576 Q1439.41 72.576 1436.13 69.3758 Q1432.85 66.1351 1432.85 57.6282 L1432.85 32.9987 L1427.38 32.9987 L1427.38 27.2059 L1432.85 27.2059 L1432.85 14.324 L1440.34 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1504.31 48.0275 L1504.31 51.6733 L1470.04 51.6733 Q1470.52 59.3701 1474.65 63.421 Q1478.83 67.4314 1486.24 67.4314 Q1490.53 67.4314 1494.54 66.3781 Q1498.59 65.3249 1502.56 63.2184 L1502.56 70.267 Q1498.55 71.9684 1494.34 72.8596 Q1490.13 73.7508 1485.79 73.7508 Q1474.94 73.7508 1468.58 67.4314 Q1462.26 61.1119 1462.26 50.3365 Q1462.26 39.1965 1468.25 32.6746 Q1474.29 26.1121 1484.5 26.1121 Q1493.65 26.1121 1498.96 32.0264 Q1504.31 37.9003 1504.31 48.0275 M1496.85 45.84 Q1496.77 39.7232 1493.41 36.0774 Q1490.09 32.4315 1484.58 32.4315 Q1478.34 32.4315 1474.57 35.9558 Q1470.85 39.4801 1470.28 45.8805 L1496.85 45.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1542.83 34.1734 Q1541.57 33.4443 1540.08 33.1202 Q1538.62 32.7556 1536.83 32.7556 Q1530.52 32.7556 1527.11 36.8875 Q1523.75 40.9789 1523.75 48.6757 L1523.75 72.576 L1516.26 72.576 L1516.26 27.2059 L1523.75 27.2059 L1523.75 34.2544 Q1526.1 30.1225 1529.87 28.1376 Q1533.63 26.1121 1539.02 26.1121 Q1539.79 26.1121 1540.72 26.2337 Q1541.66 26.3147 1542.79 26.5172 L1542.83 34.1734 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1599.99 9.54393 L1599.99 15.7418 L1592.86 15.7418 Q1588.85 15.7418 1587.27 17.3622 Q1585.73 18.9825 1585.73 23.1955 L1585.73 27.2059 L1598 27.2059 L1598 32.9987 L1585.73 32.9987 L1585.73 72.576 L1578.24 72.576 L1578.24 32.9987 L1571.11 32.9987 L1571.11 27.2059 L1578.24 27.2059 L1578.24 24.0462 Q1578.24 16.471 1581.76 13.0277 Q1585.28 9.54393 1592.94 9.54393 L1599.99 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1623.81 32.4315 Q1617.81 32.4315 1614.33 37.1306 Q1610.84 41.7891 1610.84 49.9314 Q1610.84 58.0738 1614.29 62.7728 Q1617.77 67.4314 1623.81 67.4314 Q1629.76 67.4314 1633.25 62.7323 Q1636.73 58.0333 1636.73 49.9314 Q1636.73 41.8701 1633.25 37.1711 Q1629.76 32.4315 1623.81 32.4315 M1623.81 26.1121 Q1633.53 26.1121 1639.08 32.4315 Q1644.63 38.7509 1644.63 49.9314 Q1644.63 61.0714 1639.08 67.4314 Q1633.53 73.7508 1623.81 73.7508 Q1614.05 73.7508 1608.5 67.4314 Q1602.99 61.0714 1602.99 49.9314 Q1602.99 38.7509 1608.5 32.4315 Q1614.05 26.1121 1623.81 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1683.28 34.1734 Q1682.02 33.4443 1680.52 33.1202 Q1679.06 32.7556 1677.28 32.7556 Q1670.96 32.7556 1667.56 36.8875 Q1664.2 40.9789 1664.2 48.6757 L1664.2 72.576 L1656.7 72.576 L1656.7 27.2059 L1664.2 27.2059 L1664.2 34.2544 Q1666.54 30.1225 1670.31 28.1376 Q1674.08 26.1121 1679.47 26.1121 Q1680.24 26.1121 1681.17 26.2337 Q1682.1 26.3147 1683.23 26.5172 L1683.28 34.1734 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1746.39 28.5427 L1746.39 35.5912 Q1743.23 33.9709 1739.83 33.1607 Q1736.42 32.3505 1732.78 32.3505 Q1727.23 32.3505 1724.43 34.0519 Q1721.68 35.7533 1721.68 39.156 Q1721.68 41.7486 1723.66 43.2475 Q1725.65 44.7058 1731.64 46.0426 L1734.19 46.6097 Q1742.13 48.3111 1745.46 51.4303 Q1748.82 54.509 1748.82 60.0587 Q1748.82 66.3781 1743.8 70.0644 Q1738.81 73.7508 1730.06 73.7508 Q1726.42 73.7508 1722.45 73.0216 Q1718.52 72.3329 1714.14 70.9151 L1714.14 63.2184 Q1718.27 65.3654 1722.29 66.4591 Q1726.3 67.5124 1730.23 67.5124 Q1735.49 67.5124 1738.33 65.73 Q1741.16 63.9071 1741.16 60.6258 Q1741.16 57.5877 1739.1 55.9673 Q1737.07 54.3469 1730.14 52.8481 L1727.55 52.2405 Q1720.62 50.7821 1717.55 47.7845 Q1714.47 44.7463 1714.47 39.4801 Q1714.47 33.0797 1719 29.5959 Q1723.54 26.1121 1731.89 26.1121 Q1736.02 26.1121 1739.66 26.7198 Q1743.31 27.3274 1746.39 28.5427 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1796.01 35.9153 Q1798.81 30.8922 1802.7 28.5022 Q1806.58 26.1121 1811.85 26.1121 Q1818.94 26.1121 1822.79 31.0947 Q1826.64 36.0368 1826.64 45.1919 L1826.64 72.576 L1819.14 72.576 L1819.14 45.4349 Q1819.14 38.913 1816.83 35.7533 Q1814.52 32.5936 1809.78 32.5936 Q1803.99 32.5936 1800.63 36.4419 Q1797.27 40.2903 1797.27 46.9338 L1797.27 72.576 L1789.77 72.576 L1789.77 45.4349 Q1789.77 38.8725 1787.46 35.7533 Q1785.16 32.5936 1780.33 32.5936 Q1774.62 32.5936 1771.26 36.4824 Q1767.9 40.3308 1767.9 46.9338 L1767.9 72.576 L1760.4 72.576 L1760.4 27.2059 L1767.9 27.2059 L1767.9 34.2544 Q1770.45 30.082 1774.02 28.0971 Q1777.58 26.1121 1782.48 26.1121 Q1787.42 26.1121 1790.87 28.6237 Q1794.35 31.1352 1796.01 35.9153 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1862.12 49.7694 Q1853.09 49.7694 1849.61 51.8354 Q1846.12 53.9013 1846.12 58.8839 Q1846.12 62.8538 1848.71 65.2034 Q1851.35 67.5124 1855.84 67.5124 Q1862.04 67.5124 1865.77 63.1374 Q1869.54 58.7219 1869.54 51.4303 L1869.54 49.7694 L1862.12 49.7694 M1876.99 46.6907 L1876.99 72.576 L1869.54 72.576 L1869.54 65.6895 Q1866.98 69.8214 1863.18 71.8063 Q1859.37 73.7508 1853.86 73.7508 Q1846.89 73.7508 1842.76 69.8619 Q1838.67 65.9325 1838.67 59.3701 Q1838.67 51.7138 1843.77 47.825 Q1848.92 43.9361 1859.08 43.9361 L1869.54 43.9361 L1869.54 43.2069 Q1869.54 38.0623 1866.13 35.2672 Q1862.77 32.4315 1856.65 32.4315 Q1852.76 32.4315 1849.08 33.3632 Q1845.39 34.295 1841.99 36.1584 L1841.99 29.2718 Q1846.08 27.692 1849.93 26.9223 Q1853.78 26.1121 1857.42 26.1121 Q1867.27 26.1121 1872.13 31.2163 Q1876.99 36.3204 1876.99 46.6907 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1892.34 9.54393 L1899.8 9.54393 L1899.8 72.576 L1892.34 72.576 L1892.34 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M1915.39 9.54393 L1922.85 9.54393 L1922.85 72.576 L1915.39 72.576 L1915.39 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2000.14 35.9153 Q2002.93 30.8922 2006.82 28.5022 Q2010.71 26.1121 2015.98 26.1121 Q2023.06 26.1121 2026.91 31.0947 Q2030.76 36.0368 2030.76 45.1919 L2030.76 72.576 L2023.27 72.576 L2023.27 45.4349 Q2023.27 38.913 2020.96 35.7533 Q2018.65 32.5936 2013.91 32.5936 Q2008.12 32.5936 2004.75 36.4419 Q2001.39 40.2903 2001.39 46.9338 L2001.39 72.576 L1993.9 72.576 L1993.9 45.4349 Q1993.9 38.8725 1991.59 35.7533 Q1989.28 32.5936 1984.46 32.5936 Q1978.75 32.5936 1975.39 36.4824 Q1972.02 40.3308 1972.02 46.9338 L1972.02 72.576 L1964.53 72.576 L1964.53 27.2059 L1972.02 27.2059 L1972.02 34.2544 Q1974.58 30.082 1978.14 28.0971 Q1981.71 26.1121 1986.61 26.1121 Q1991.55 26.1121 1994.99 28.6237 Q1998.48 31.1352 2000.14 35.9153 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2066.25 49.7694 Q2057.21 49.7694 2053.73 51.8354 Q2050.25 53.9013 2050.25 58.8839 Q2050.25 62.8538 2052.84 65.2034 Q2055.47 67.5124 2059.97 67.5124 Q2066.17 67.5124 2069.89 63.1374 Q2073.66 58.7219 2073.66 51.4303 L2073.66 49.7694 L2066.25 49.7694 M2081.11 46.6907 L2081.11 72.576 L2073.66 72.576 L2073.66 65.6895 Q2071.11 69.8214 2067.3 71.8063 Q2063.49 73.7508 2057.98 73.7508 Q2051.02 73.7508 2046.88 69.8619 Q2042.79 65.9325 2042.79 59.3701 Q2042.79 51.7138 2047.9 47.825 Q2053.04 43.9361 2063.21 43.9361 L2073.66 43.9361 L2073.66 43.2069 Q2073.66 38.0623 2070.26 35.2672 Q2066.9 32.4315 2060.78 32.4315 Q2056.89 32.4315 2053.2 33.3632 Q2049.52 34.295 2046.11 36.1584 L2046.11 29.2718 Q2050.21 27.692 2054.05 26.9223 Q2057.9 26.1121 2061.55 26.1121 Q2071.39 26.1121 2076.25 31.2163 Q2081.11 36.3204 2081.11 46.6907 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2103.84 14.324 L2103.84 27.2059 L2119.19 27.2059 L2119.19 32.9987 L2103.84 32.9987 L2103.84 57.6282 Q2103.84 63.1779 2105.34 64.7578 Q2106.88 66.3376 2111.54 66.3376 L2119.19 66.3376 L2119.19 72.576 L2111.54 72.576 Q2102.91 72.576 2099.63 69.3758 Q2096.35 66.1351 2096.35 57.6282 L2096.35 32.9987 L2090.88 32.9987 L2090.88 27.2059 L2096.35 27.2059 L2096.35 14.324 L2103.84 14.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2164.32 35.9153 Q2167.12 30.8922 2171 28.5022 Q2174.89 26.1121 2180.16 26.1121 Q2187.25 26.1121 2191.1 31.0947 Q2194.94 36.0368 2194.94 45.1919 L2194.94 72.576 L2187.45 72.576 L2187.45 45.4349 Q2187.45 38.913 2185.14 35.7533 Q2182.83 32.5936 2178.09 32.5936 Q2172.3 32.5936 2168.94 36.4419 Q2165.58 40.2903 2165.58 46.9338 L2165.58 72.576 L2158.08 72.576 L2158.08 45.4349 Q2158.08 38.8725 2155.77 35.7533 Q2153.46 32.5936 2148.64 32.5936 Q2142.93 32.5936 2139.57 36.4824 Q2136.21 40.3308 2136.21 46.9338 L2136.21 72.576 L2128.71 72.576 L2128.71 27.2059 L2136.21 27.2059 L2136.21 34.2544 Q2138.76 30.082 2142.32 28.0971 Q2145.89 26.1121 2150.79 26.1121 Q2155.73 26.1121 2159.18 28.6237 Q2162.66 31.1352 2164.32 35.9153 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2209.04 54.671 L2209.04 27.2059 L2216.5 27.2059 L2216.5 54.3874 Q2216.5 60.8284 2219.01 64.0691 Q2221.52 67.2693 2226.54 67.2693 Q2232.58 67.2693 2236.06 63.421 Q2239.59 59.5726 2239.59 52.9291 L2239.59 27.2059 L2247.04 27.2059 L2247.04 72.576 L2239.59 72.576 L2239.59 65.6084 Q2236.87 69.7404 2233.27 71.7658 Q2229.7 73.7508 2224.96 73.7508 Q2217.14 73.7508 2213.09 68.8897 Q2209.04 64.0286 2209.04 54.671 M2227.8 26.1121 L2227.8 26.1121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2262.39 9.54393 L2269.85 9.54393 L2269.85 72.576 L2262.39 72.576 L2262.39 9.54393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2314.37 28.5427 L2314.37 35.5912 Q2311.21 33.9709 2307.8 33.1607 Q2304.4 32.3505 2300.75 32.3505 Q2295.2 32.3505 2292.41 34.0519 Q2289.65 35.7533 2289.65 39.156 Q2289.65 41.7486 2291.64 43.2475 Q2293.62 44.7058 2299.62 46.0426 L2302.17 46.6097 Q2310.11 48.3111 2313.43 51.4303 Q2316.8 54.509 2316.8 60.0587 Q2316.8 66.3781 2311.77 70.0644 Q2306.79 73.7508 2298.04 73.7508 Q2294.39 73.7508 2290.42 73.0216 Q2286.5 72.3329 2282.12 70.9151 L2282.12 63.2184 Q2286.25 65.3654 2290.26 66.4591 Q2294.27 67.5124 2298.2 67.5124 Q2303.47 67.5124 2306.3 65.73 Q2309.14 63.9071 2309.14 60.6258 Q2309.14 57.5877 2307.07 55.9673 Q2305.05 54.3469 2298.12 52.8481 L2295.53 52.2405 Q2288.6 50.7821 2285.52 47.7845 Q2282.44 44.7463 2282.44 39.4801 Q2282.44 33.0797 2286.98 29.5959 Q2291.52 26.1121 2299.86 26.1121 Q2304 26.1121 2307.64 26.7198 Q2311.29 27.3274 2314.37 28.5427 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip742)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="250.464,1397.69 658.676,1324.73 1066.89,1096.54 1475.1,809.039 1883.31,468.735 2291.52,161.699 "></polyline>
<polyline clip-path="url(#clip742)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="250.464,1435.94 658.676,1383.28 1066.89,1185.7 1475.1,845.949 1883.31,459.218 2291.52,177.223 "></polyline>
<path clip-path="url(#clip740)" d="M1967.34 1429.14 L2280.64 1429.14 L2280.64 1273.62 L1967.34 1273.62  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<polyline clip-path="url(#clip740)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1967.34,1429.14 2280.64,1429.14 2280.64,1273.62 1967.34,1273.62 1967.34,1429.14 "></polyline>
<polyline clip-path="url(#clip740)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1991.38,1325.46 2135.62,1325.46 "></polyline>
<path clip-path="url(#clip740)" d="M2180.53 1313.88 L2172.22 1318.37 L2180.53 1322.88 L2179.19 1325.15 L2171.41 1320.45 L2171.41 1329.18 L2168.78 1329.18 L2168.78 1320.45 L2161 1325.15 L2159.66 1322.88 L2167.97 1318.37 L2159.66 1313.88 L2161 1311.58 L2168.78 1316.28 L2168.78 1307.56 L2171.41 1307.56 L2171.41 1316.28 L2179.19 1311.58 L2180.53 1313.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip740)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1991.38,1377.3 2135.62,1377.3 "></polyline>
<path clip-path="url(#clip740)" d="M2180 1373.63 Q2181.6 1370.76 2183.82 1369.4 Q2186.04 1368.03 2189.05 1368.03 Q2193.1 1368.03 2195.3 1370.88 Q2197.5 1373.7 2197.5 1378.93 L2197.5 1394.58 L2193.22 1394.58 L2193.22 1379.07 Q2193.22 1375.35 2191.9 1373.54 Q2190.58 1371.73 2187.87 1371.73 Q2184.56 1371.73 2182.64 1373.93 Q2180.72 1376.13 2180.72 1379.93 L2180.72 1394.58 L2176.44 1394.58 L2176.44 1379.07 Q2176.44 1375.32 2175.12 1373.54 Q2173.8 1371.73 2171.04 1371.73 Q2167.78 1371.73 2165.86 1373.96 Q2163.94 1376.16 2163.94 1379.93 L2163.94 1394.58 L2159.66 1394.58 L2159.66 1368.66 L2163.94 1368.66 L2163.94 1372.68 Q2165.4 1370.3 2167.43 1369.17 Q2169.47 1368.03 2172.27 1368.03 Q2175.1 1368.03 2177.06 1369.47 Q2179.05 1370.9 2180 1373.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2205.56 1384.35 L2205.56 1368.66 L2209.82 1368.66 L2209.82 1384.19 Q2209.82 1387.87 2211.25 1389.72 Q2212.69 1391.55 2215.56 1391.55 Q2219.01 1391.55 2221 1389.35 Q2223.01 1387.15 2223.01 1383.35 L2223.01 1368.66 L2227.27 1368.66 L2227.27 1394.58 L2223.01 1394.58 L2223.01 1390.6 Q2221.46 1392.96 2219.4 1394.12 Q2217.36 1395.25 2214.66 1395.25 Q2210.19 1395.25 2207.87 1392.48 Q2205.56 1389.7 2205.56 1384.35 M2216.28 1368.03 L2216.28 1368.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2236.04 1358.56 L2240.3 1358.56 L2240.3 1394.58 L2236.04 1394.58 L2236.04 1358.56 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip740)" d="M2251.9 1388.7 L2256.6 1388.7 L2256.6 1394.58 L2251.9 1394.58 L2251.9 1388.7 M2251.9 1360.02 L2256.6 1360.02 L2256.6 1375.18 L2256.14 1383.45 L2252.39 1383.45 L2251.9 1375.18 L2251.9 1360.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path></svg>
</div>
</div>
<p>Though using a mutating form is never bad and always is a little bit better.</p>
</section>
<section id="optimizing-memory-use-summary" class="level3" data-number="1.1.11">
<h3 data-number="1.1.11" class="anchored" data-anchor-id="optimizing-memory-use-summary"><span class="header-section-number">1.1.11</span> Optimizing Memory Use Summary</h3>
<ul>
<li>Avoid cache misses by reusing values</li>
<li>Iterate along columns</li>
<li>Avoid heap allocations in inner loops</li>
<li>Heap allocations occur when the size of things is not proven at compile-time</li>
<li>Use fused broadcasts (with mutated outputs) to avoid heap allocations</li>
<li>Array vectorization confers no special benefit in Julia because Julia loops are as fast as C or Fortran</li>
<li>Use views instead of slices when applicable</li>
<li>Avoiding heap allocations is most necessary for O(n) algorithms or algorithms with small arrays</li>
<li>Use StaticArrays.jl to avoid heap allocations of small arrays in inner loops</li>
</ul>
</section>
</section>
<section id="julias-type-inference-and-the-compiler" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="julias-type-inference-and-the-compiler"><span class="header-section-number">1.2</span> Julia’s Type Inference and the Compiler</h2>
<p>Many people think Julia is fast because it is JIT compiled. That is simply not true (we’ve already shown examples where Julia code isn’t fast, but it’s always JIT compiled!). Instead, the reason why Julia is fast is because the combination of two ideas:</p>
<ul>
<li>Type inference</li>
<li>Type specialization in functions</li>
</ul>
<p>These two features naturally give rise to Julia’s core design feature: multiple dispatch. Let’s break down these pieces.</p>
<section id="type-inference" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="type-inference"><span class="header-section-number">1.2.1</span> Type Inference</h3>
<p>At the core level of the computer, everything has a type. Some languages are more explicit about said types, while others try to hide the types from the user. A type tells the compiler how to to store and interpret the memory of a value. For example, if the compiled code knows that the value in the register is supposed to be interpreted as a 64-bit floating point number, then it understands that slab of memory like:</p>
<p><img src="https://i.stack.imgur.com/ZUbLc.png" class="img-fluid"></p>
<p>Importantly, it will know what to do for function calls. If the code tells it to add two floating point numbers, it will send them as inputs to the Floating Point Unit (FPU) which will give the output.</p>
<p>If the types are not known, then… ? So one cannot actually compute until the types are known, since otherwise it’s impossible to interpret the memory.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Compiled</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Interpreted</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Hybrid</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>In languages like C, the programmer has to declare the types of variables in the program:</p>
<pre><code>void add(double *a, double *b, double *c, size_t n){
  size_t i;
  for(i = 0; i &lt; n; ++i) {
    c[i] = a[i] + b[i];
  }
}</code></pre>
<p>The types are known at compile time because the programmer set it in stone.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>In many interpreted languages like Python, types are checked at runtime. For example,</p>
<pre><code>a = 2
b = 4
a + b</code></pre>
<p>when the addition occurs, the Python interpreter will check the object holding the values and ask it for its types, and use those types to know how to compute the <code>+</code> function. For this reason, the add function in Python is rather complex since it needs to decode and have a version for all primitive types!</p>
<p>Not only is there runtime overhead checks in function calls due to to not being explicit about types, there is also a memory overhead since it is impossible to know how much memory a value with take since that’s a property of its type. Thus the Python interpreter cannot statically guarantee exact unchanging values for the size that a value would take in the stack, meaning that the variables are not stack-allocated. This means that every number ends up heap-allocated, which hopefully begins to explain why this is not as fast as C.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>The solution is Julia is somewhat of a hybrid. The Julia code looks like:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">+</span> b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>6</code></pre>
</div>
</div>
<p>However, before JIT compilation, Julia runs a type inference algorithm which finds out that <code>A</code> is an <code>Int</code>, and <code>B</code> is an <code>Int</code>. You can then understand that if it can prove that <code>A + B</code> is an <code>Int</code>, then it can propagate all of the types through.</p>
</div>
</div>
</div>
</section>
<section id="type-specialization-in-functions" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="type-specialization-in-functions"><span class="header-section-number">1.2.2</span> Type Specialization in Functions</h3>
<p>Julia is able to propagate type inference through functions because, even if a function is “untyped”, Julia will interpret this as a <em>generic function</em> over possible <em>methods</em>, where every method has a concrete type. This means that in Julia, the function:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(x, y) <span class="op">=</span> x <span class="op">+</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>f (generic function with 1 method)</code></pre>
</div>
</div>
<p>is not what you may think of as a “single function”, since given inputs of different types it will actually be a different function. We can see this by examining the <em>LLVM IR</em> (LLVM is Julia’s compiler, the IR is the <em>Intermediate Representation</em>, i.e.&nbsp;a platform-independent representation of assembly that lives in LLVM that it knows how to convert into assembly per architecture):</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">InteractiveUtils</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">f</span>(<span class="fl">2</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[18]:1 within `f`
define i64 @julia_f_2304(i64 signext %0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>, i64 signext %1) #0 {
top:
; ┌ @ int.jl:87 within `+`
   %2 = add i64 %1, %0
; └
  ret i64 %2
}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">f</span>(<span class="fl">2.0</span>, <span class="fl">5.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[18]:1 within `f`
define double @julia_f_2327(double %0, double %1) #0 {
top:
; ┌ @ float.jl:408 within `+`
   %2 = fadd double %0, %1
; └
  ret double %2
}</code></pre>
</div>
</div>
<p>Notice that when <code>f</code> is the function that takes in two <code>Int</code>s, <code>Int</code>s add to give an <code>Int</code> and thus <code>f</code> outputs an <code>Int</code>. When <code>f</code> is the function that takes two <code>Float64</code>s, <code>f</code> returns a <code>Float64</code>. Thus in the code:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">g</span>(x, y)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  c <span class="op">=</span> <span class="fu">f</span>(x, a)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  d <span class="op">=</span> <span class="fu">f</span>(b, c)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(d, y)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">g</span>(<span class="fl">2</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[21]:1 within `g`
define i64 @julia_g_2329(i64 signext %0, i64 signext %1) #0 {
top:
;  @ In[21]:5 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ int.jl:87 within `+`
    %2 = add i64 %0, 6
; └└
;  @ In[21]:6 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ int.jl:87 within `+`
    %3 = add i64 %2, %1
; └└
  ret i64 %3
}</code></pre>
</div>
</div>
<p><code>g</code> on two <code>Int</code> inputs is a function that has <code>Int</code>s at every step along the way and spits out an <code>Int</code>. We can use the <code>@code_warntype</code> macro to better see the inference along the steps of the function:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">g</span>(<span class="fl">2</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for g(::Int64, ::Int64)
  from g(x, y) @ Main In[21]:1
Arguments
  #self#::Core.Const(g)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  x::Int64
  y::Int64
Locals
  d::Int64
  c::Int64
  b::Int64
  a::Int64
Body::Int64</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>1 ─      </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(a = 4)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>│        (b = 2)
│        (c = Main.f(x, a</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>::Core.Const(4)))
│        (d = Main.f(b::Core.Const(2), c))
│   %5 = Main.f(d, y)::Int64
└──      return %5
</code></pre>
</div>
</div>
<p>What happens on mixtures?</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">f</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[18]:1 within `f`
define double @julia_f_2829(double %0, i64 signext %1) #0 {
top:
; ┌ @ promotion.jl:410 within `+`
; │┌ @ promotion.jl:381 within `promote`
; ││┌ @ promotion.jl:358 within `_promote`
; │││┌ @ number.jl:7 within `convert`
; ││││┌ @ float.jl:159 within `Float64`
       %2 = sitofp i64 %1 to double
; │└└└└
; │ @ promotion.jl:410 within `+` @ float.jl:408
   %3 = fadd double %2, %0
; └
  ret double %3
}</code></pre>
</div>
</div>
<p>When we add an <code>Int</code> to a <code>Float64</code>, we promote the <code>Int</code> to a <code>Float64</code> and then perform the <code>+</code> between two <code>Float64</code>s. When we go to the full function, we see that it can still infer:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">g</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for g(::Float64, ::Int64)
  from g(x, y) @ Main In[21]:1
Arguments
  #self#::Core.Const(g)
  x::Float64
  y::Int64
Locals
  d::Float64
  c::Float64
  b::Int64
  a::Int64
Body::Float64
1 ─      (a = 4)
│        (b = 2)
│        (c = Main.f(x, a::Core.Const(4)))
│        (d = Main.f(b::Core.Const(2), c))
│   %5 = Main.f(d, y)::Float64
└──      return %5
</code></pre>
</div>
</div>
<p>and it uses this to build a very efficient assembly code because it knows exactly what the types will be at every step:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">g</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[21]:1 within `g`
define double @julia_g_2832(double %0, i64 signext %1) #0 {
top:
;  @ In[21]:4 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ promotion.jl:410 within `+` @ float.jl:408
    %2 = fadd double %0, 4.000000e+00
; └└
;  @ In[21]:5 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ promotion.jl:410 within `+` @ float.jl:408
    %3 = fadd double %2, 2.000000e+00
; └└
;  @ In[21]:6 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ promotion.jl:410 within `+`
; ││┌ @ promotion.jl:381 within `promote`
; │││┌ @ promotion.jl:358 within `_promote`
; ││││┌ @ number.jl:7 within `convert`
; │││││┌ @ float.jl:159 within `Float64`
        %4 = sitofp i64 %1 to double
; ││└└└└
; ││ @ promotion.jl:410 within `+` @ float.jl:408
    %5 = fadd double %3, %4
; └└
  ret double %5
}</code></pre>
</div>
</div>
<p>(notice how it handles the constant <em>literals</em> 4 and 2: it converted them at compile time to reduce the algorithm to 3 floating point additions).</p>
</section>
<section id="type-stability" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="type-stability"><span class="header-section-number">1.2.3</span> Type Stability</h3>
<p>Why is the inference algorithm able to infer all of the types of <code>g</code>? It’s because it knows the types coming out of <code>f</code> at compile time. Given an <code>Int</code> and a <code>Float64</code>, <code>f</code> will always output a <code>Float64</code>, and thus it can continue with inference knowing that <code>c</code>, <code>d</code>, and eventually the output is <code>Float64</code>. Thus in order for this to occur, we need that the type of the output on our function is directly inferred from the type of the input. This property is known as type-stability.</p>
<p>An example of breaking it is as follows:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">h</span>(x, y)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  out <span class="op">=</span> x <span class="op">+</span> y</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand</span>() <span class="op">&lt;</span> <span class="fl">0.5</span> ? out <span class="op">:</span> <span class="fu">Float64</span>(out)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>h (generic function with 1 method)</code></pre>
</div>
</div>
<p>Here, on an integer input the output’s type is randomly either Int or Float64, and thus the output is unknown:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">h</span>(<span class="fl">2</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for h(::Int64, ::Int64)
  from h(x, y) @ Main In[26]:1
Arguments
  #self#::Core.Const(h)
  x::Int64
  y::Int64
Locals
  out::Int64
Body::Union{Float64, Int64}
1 ─      (out = x + y)
│   %2 = Main.rand()::Float64
│   %3 = (%2 &lt; 0.5)::Bool
└──      goto #3 if not %3
2 ─      return out
3 ─ %6 = Main.Float64(out)::Float64
└──      return %6
</code></pre>
</div>
</div>
<p>This means that its output type is <code>Union{Int,Float64}</code> (Julia uses union types to keep the types still somewhat constrained). Once there are multiple choices, those need to get propagated through the compiler, and all subsequent calculations are the result of either being an <code>Int</code> or a <code>Float64</code>.</p>
<p>(Note that Julia has small union optimizations, so if this union is of size 4 or less then Julia will still be able to optimize it quite a bit.)</p>
</section>
<section id="multiple-dispatch" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="multiple-dispatch"><span class="header-section-number">1.2.4</span> Multiple Dispatch</h3>
<p>The <code>+</code> function on numbers was implemented in Julia, so how were these rules all written down? The answer is multiple dispatch. In Julia, you can tell a function how to act differently on different types by using type assertions on the input values. For example, let’s make a function that computes <code>2x + y</code> on <code>Int</code> and <code>x/y</code> on <code>Float64</code>:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(x<span class="op">::</span><span class="dt">Int</span>, y<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="fl">2</span>x <span class="op">+</span> y</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(x<span class="op">::</span><span class="dt">Float64</span>, y<span class="op">::</span><span class="dt">Float64</span>) <span class="op">=</span> x <span class="op">/</span> y</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> <span class="fu">ff</span>(<span class="fl">2</span>, <span class="fl">5</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> <span class="fu">ff</span>(<span class="fl">2.0</span>, <span class="fl">5.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ff(2, 5) = 9
ff(2.0, 5.0) = 0.4</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>0.4</code></pre>
</div>
</div>
<p>The <code>+</code> function in Julia is just defined as <code>+(a, b)</code>, and we can actually point to that code in the Julia distribution:</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@which</span> <span class="fu">+</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
+(x::<b>Number</b>, y::<b>Number</b>) in Base at <a href="https://github.com/JuliaLang/julia/tree/8e5136fa2979885081cd502d2210633dff1d2a1a/base/promotion.jl#L410" target="_blank">promotion.jl:410</a>
</div>
</div>
<p>To control at a higher level, Julia uses <em>abstract types</em>. For example, <code>Float64 &lt;: AbstractFloat</code>, meaning <code>Float64</code>s are a subtype of <code>AbstractFloat</code>. We also have that <code>Int &lt;: Integer</code>, while both <code>AbstractFloat &lt;: Number</code> and <code>Integer &lt;: Number</code>.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Type-hierarchy-for-julia-numbers.png/800px-Type-hierarchy-for-julia-numbers.png" class="img-fluid"></p>
<p>Julia allows the user to define dispatches at a higher level, and the version that is called is the most strict version that is correct. For example, right now with <code>ff</code> we will get a <code>MethodError</code> if we call it between a <code>Int</code> and a <code>Float64</code> because no such method exists:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>LoadError: MethodError: no method matching ff(::Float64, ::Int64)

[0mClosest candidates are:
[0m  ff([91m::Int64[39m, ::Int64)
[0m[90m   @[39m [35mMain[39m [90m[4mIn[28]:1[24m[39m
[0m  ff(::Float64, [91m::Float64[39m)
[0m[90m   @[39m [35mMain[39m [90m[4mIn[28]:2[24m[39m</code></pre>
</div>
</div>
<p>However, we can add a <em>fallback method</em> to the function <code>ff</code> for two numbers:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(x<span class="op">::</span><span class="dt">Number</span>, y<span class="op">::</span><span class="dt">Number</span>) <span class="op">=</span> x <span class="op">+</span> y</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>7.0</code></pre>
</div>
</div>
<p>Notice that the fallback method still specializes on the inputs:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">ff</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[31]:1 within `ff`
define double @julia_ff_3211(double %0, i64 signext %1) #0 {
top:
; ┌ @ promotion.jl:410 within `+`
; │┌ @ promotion.jl:381 within `promote`
; ││┌ @ promotion.jl:358 within `_promote`
; │││┌ @ number.jl:7 within `convert`
; ││││┌ @ float.jl:159 within `Float64`
       %2 = sitofp i64 %1 to double
; │└└└└
; │ @ promotion.jl:410 within `+` @ float.jl:408
   %3 = fadd double %2, %0
; └
  ret double %3
}</code></pre>
</div>
</div>
<p>It’s essentially just a template for what functions to possibly try and create given the types that are seen. When it sees <code>Float64</code> and <code>Int</code>, it knows it should try and create the function that does <code>x+y</code>, and once it knows it’s <code>Float64</code> plus a <code>Int</code>, it knows it should create the function that converts the <code>Int</code> to a <code>Float64</code> and then does addition between two <code>Float64</code>s, and that is precisely the generated LLVM IR on this pair of input types.</p>
<p>And that’s essentially Julia’s secret sauce: since it’s always specializing its types on each function, if those functions themselves can infer the output, then the entire function can be inferred and generate optimal code, which is then optimized by the compiler and out comes an efficient function. If types can’t be inferred, Julia falls back to a slower “Python” mode (though with optimizations in cases like small unions). Users then get control over this specialization process through multiple dispatch, which is then Julia’s core feature since it allows adding new options without any runtime cost.</p>
</section>
<section id="any-fallbacks" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5" class="anchored" data-anchor-id="any-fallbacks"><span class="header-section-number">1.2.5</span> Any Fallbacks</h3>
<p>Note that <code>f(x, y) = x + y</code> is equivalent to <code>f(x::Any, y::Any) = x + y</code>, where <code>Any</code> is the maximal supertype of every Julia type. Thus <code>f(x, y) = x + y</code> is essentially a fallback for all possible input values, telling it what to do in the case that no other dispatches exist. However, note that this dispatch itself is not slow, since it will be specialized on the input types.</p>
</section>
<section id="ambiguities" class="level3" data-number="1.2.6">
<h3 data-number="1.2.6" class="anchored" data-anchor-id="ambiguities"><span class="header-section-number">1.2.6</span> Ambiguities</h3>
<p>The version that is called is the most strict version that is correct. What happens if it’s impossible to define “the most strict version”? For example,</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(x<span class="op">::</span><span class="dt">Float64</span>, y<span class="op">::</span><span class="dt">Number</span>) <span class="op">=</span> <span class="fl">5</span>x <span class="op">+</span> <span class="fl">2</span>y</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(x<span class="op">::</span><span class="dt">Number</span>, y<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> x <span class="op">-</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>ff (generic function with 5 methods)</code></pre>
</div>
</div>
<p>What should it call on <code>f(2.0, 5)</code> now? <code>ff(x::Float64, y::Number)</code> and <code>ff(x::Number, y::Int)</code> are both more strict than <code>ff(x::Number, y::Number)</code>, so one of them should be called, but neither are more strict than each other, and thus you will end up with an ambiguity error:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ff</span>(<span class="fl">2.0</span>, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>LoadError: MethodError: ff(::Float64, ::Int64) is ambiguous.

Candidates:
  ff([90mx[39m::[1mFloat64[22m, [90my[39m::[1mNumber[22m)
[90m    @[39m [90mMain[39m [90m[4mIn[33]:1[24m[39m
  ff([90mx[39m::[1mNumber[22m, [90my[39m::[1mInt64[22m)
[90m    @[39m [90mMain[39m [90m[4mIn[33]:2[24m[39m

Possible fix, define
  ff(::Float64, ::Int64)</code></pre>
</div>
</div>
</section>
<section id="untyped-containers" class="level3" data-number="1.2.7">
<h3 data-number="1.2.7" class="anchored" data-anchor-id="untyped-containers"><span class="header-section-number">1.2.7</span> Untyped Containers</h3>
<p>One way to ruin inference is to use an untyped container. For example, the array constructors use type inference themselves to know what their container type will be. Therefore,</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>3-element Vector{Float64}:
 1.0
 2.0
 3.0</code></pre>
</div>
</div>
<p>uses type inference on its inputs to know that it should be something that holds <code>Float64</code> values, and thus it is a 1-dimensional array of <code>Float64</code> values, or <code>Array{Float64, 1}</code>. The accesses:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>a[<span class="fl">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>1.0</code></pre>
</div>
</div>
<p>are then inferred, since this is just the function <code>getindex(a::Array{T}, i) where T</code> which is a function that will produce something of type <code>T</code>, the element type of the array. However, if we tell Julia to make an array with element type <code>Any</code>:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> [<span class="st">"1.0"</span>, <span class="fl">2</span>, <span class="fl">2.0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>3-element Vector{Any}:
  "1.0"
 2
 2.0</code></pre>
</div>
</div>
<p>(here, Julia falls back to <code>Any</code> because it cannot promote the values to the same type), then the best inference can do on the output is to say it could have any type:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bad_container</span>(a)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  a[<span class="fl">2</span>]</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">bad_container</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for bad_container(::Vector{Float64})
  from bad_container(a) @ Main In[38]:1
Arguments
  #self#::Core.Const(bad_container)
  a::Vector{Float64}
Body::Float64
1 ─ %1 = Base.getindex(a, 2)::Float64
└──      return %1
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">bad_container</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for bad_container(::Vector{Any})
  from bad_container(a) @ Main In[38]:1
Arguments
  #self#::Core.Const(bad_container)
  a::Vector{Any}
Body::Any
1 ─ %1 = Base.getindex(a, 2)::Any
└──      return %1
</code></pre>
</div>
</div>
<p>This is one common way that type inference can breakdown. For example, even if the array is all numbers, we can still break inference:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dt">Number</span>[<span class="fl">1.0</span>, <span class="fl">3</span>]</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">q</span>(x)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  c <span class="op">=</span> <span class="fu">f</span>(x[<span class="fl">1</span>], a)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  d <span class="op">=</span> <span class="fu">f</span>(b, c)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(d, x[<span class="fl">2</span>])</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">q</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for q(::Vector{Number})
  from q(x) @ Main In[40]:2
Arguments
  #self#::Core.Const(q)
  x::Vector{Number}
Locals
  d::Any
  c::Any
  b::Int64
  a::Int64
Body::Any
1 ─      (a = 4)
│        (b = 2)
│   %3 = Base.getindex(x, 1)::Number
│        (c = Main.f(%3, a::Core.Const(4)))
│        (d = Main.f(b::Core.Const(2), c))
│   %6 = d::Any
│   %7 = Base.getindex(x, 2)::Number
│   %8 = Main.f(%6, %7)::Any
└──      return %8
</code></pre>
</div>
</div>
<p>Here the type inference algorithm quickly gives up and infers to <code>Any</code>, losing all specialization and automatically switching to Python-style runtime type checking.</p>
</section>
<section id="type-definitions" class="level3" data-number="1.2.8">
<h3 data-number="1.2.8" class="anchored" data-anchor-id="type-definitions"><span class="header-section-number">1.2.8</span> Type definitions</h3>
</section>
<section id="value-types-and-isbits" class="level3" data-number="1.2.9">
<h3 data-number="1.2.9" class="anchored" data-anchor-id="value-types-and-isbits"><span class="header-section-number">1.2.9</span> Value types and isbits</h3>
<p>In Julia, types which can fully inferred and which are composed of primitive or <code>isbits</code> types are value types. This means that, inside of an array, their values are the values of the type itself, and not a pointer to the values.</p>
<p>You can check if the type is a value type through <code>isbits</code>:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">isbits</span>(<span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>true</code></pre>
</div>
</div>
<p>Note that a Julia <code>struct</code> which holds i<code>sbits</code> values is <code>isbits</code> as well, if it’s fully inferred:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MyComplex</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  real<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  imag<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">isbits</span>(<span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>true</code></pre>
</div>
</div>
<p>We can see that the compiler knows how to use this efficiently since it knows that what comes out is always <code>Float64</code>:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MyComplex</span>, b<span class="op">::</span><span class="dt">MyComplex</span>) <span class="op">=</span> <span class="fu">MyComplex</span>(a.real <span class="op">+</span> b.real, a.imag <span class="op">+</span> b.imag)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MyComplex</span>, b<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="fu">MyComplex</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(b<span class="op">::</span><span class="dt">Int</span>, a<span class="op">::</span><span class="dt">MyComplex</span>) <span class="op">=</span> <span class="fu">MyComplex</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(<span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>),<span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>MyComplex(8.0, 2.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">g</span>(<span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>),<span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for g(::MyComplex, ::MyComplex)
  from g(x, y) @ Main In[21]:1
Arguments
  #self#::Core.Const(g)
  x::MyComplex
  y::MyComplex
Locals
  d::MyComplex
  c::MyComplex
  b::Int64
  a::Int64
Body::MyComplex
1 ─      (a = 4)
│        (b = 2)
│        (c = Main.f(x, a::Core.Const(4)))
│        (d = Main.f(b::Core.Const(2), c))
│   %5 = Main.f(d, y)::MyComplex
└──      return %5
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">g</span>(<span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>),<span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[21]:1 within `g`
define void @julia_g_3688([2 x double]* noalias nocapture noundef nonnull sret([2 x double]) align 8 dereferenceable(16) %0, [2 x double]* nocapture noundef nonnull readonly align 8 dereferenceable(16) %1, [2 x double]* nocapture noundef nonnull readonly align 8 dereferenceable(16) %2) #0 {
top:
;  @ In[21]:4 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ In[43]:2 within `+`
; ││┌ @ Base.jl:37 within `getproperty`
     %3 = getelementptr inbounds [2 x double], [2 x double]* %1, i64 0, i64 0
; ││└
; ││ @ In[43]:2 within `+` @ promotion.jl:410 @ float.jl:408
    %4 = load double, double* %3, align 8
    %5 = fadd double %4, 4.000000e+00
; ││ @ In[43]:2 within `+`
; ││┌ @ Base.jl:37 within `getproperty`
     %6 = getelementptr inbounds [2 x double], [2 x double]* %1, i64 0, i64 1
; └└└
;  @ In[21]:5 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ In[43]:3 within `+` @ promotion.jl:410 @ float.jl:408
    %7 = fadd double %5, 2.000000e+00
; └└
;  @ In[21]:6 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ In[43]:1 within `+` @ float.jl:408
    %8 = load double, double* %6, align 8
    %9 = bitcast [2 x double]* %2 to &lt;2 x double&gt;*
    %10 = load &lt;2 x double&gt;, &lt;2 x double&gt;* %9, align 8
    %11 = insertelement &lt;2 x double&gt; poison, double %7, i64 0
    %12 = insertelement &lt;2 x double&gt; %11, double %8, i64 1
    %13 = fadd &lt;2 x double&gt; %10, %12
; └└
  %14 = bitcast [2 x double]* %0 to &lt;2 x double&gt;*
  store &lt;2 x double&gt; %13, &lt;2 x double&gt;* %14, align 8
  ret void
}</code></pre>
</div>
</div>
<p>Note that the compiled code simply works directly on the <code>double</code> pieces. We can also make this be concrete without pre-specifying that the values always have to be <code>Float64</code> by using a type parameter.</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MyParameterizedComplex{T}</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  real<span class="op">::</span><span class="dt">T</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  imag<span class="op">::</span><span class="dt">T</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="fu">isbits</span>(<span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>true</code></pre>
</div>
</div>
<p>Note that <code>MyParameterizedComplex{T}</code> is a concrete type for every <code>T</code>: it is a shorthand form for defining a whole family of types.</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MyParameterizedComplex</span>, b<span class="op">::</span><span class="dt">MyParameterizedComplex</span>) <span class="op">=</span> <span class="fu">MyParameterizedComplex</span>(a.real <span class="op">+</span> b.real, a.imag <span class="op">+</span> b.imag)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MyParameterizedComplex</span>, b<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="fu">MyParameterizedComplex</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(b<span class="op">::</span><span class="dt">Int</span>, a<span class="op">::</span><span class="dt">MyParameterizedComplex</span>) <span class="op">=</span> <span class="fu">MyParameterizedComplex</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(<span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>), <span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>MyParameterizedComplex{Float64}(8.0, 2.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">g</span>(<span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>), <span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for g(::MyParameterizedComplex{Float64}, ::MyParameterizedComplex{Float64})
  from g(x, y) @ Main In[21]:1
Arguments
  #self#::Core.Const(g)
  x::MyParameterizedComplex{Float64}
  y::MyParameterizedComplex{Float64}
Locals
  d::MyParameterizedComplex{Float64}
  c::MyParameterizedComplex{Float64}
  b::Int64
  a::Int64
Body::MyParameterizedComplex{Float64}
1 ─      (a = 4)
│        (b = 2)
│        (c = Main.f(x, a::Core.Const(4)))
│        (d = Main.f(b::Core.Const(2), c))
│   %5 = Main.f(d, y)::MyParameterizedComplex{Float64}
└──      return %5
</code></pre>
</div>
</div>
<p>See that this code also automatically works and compiles efficiently for <code>Float32</code> as well:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">g</span>(<span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0f0</span>, <span class="fl">1.0f0</span>), <span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0f0</span>, <span class="fl">1.0f0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for g(::MyParameterizedComplex{Float32}, ::MyParameterizedComplex{Float32})
  from g(x, y) @ Main In[21]:1
Arguments
  #self#::Core.Const(g)
  x::MyParameterizedComplex{Float32}
  y::MyParameterizedComplex{Float32}
Locals
  d::MyParameterizedComplex{Float32}
  c::MyParameterizedComplex{Float32}
  b::Int64
  a::Int64
Body::MyParameterizedComplex{Float32}
1 ─      (a = 4)
│        (b = 2)
│        (c = Main.f(x, a::Core.Const(4)))
│        (d = Main.f(b::Core.Const(2), c))
│   %5 = Main.f(d, y)::MyParameterizedComplex{Float32}
└──      return %5
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">g</span>(<span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0f0</span>, <span class="fl">1.0f0</span>), <span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0f0</span>, <span class="fl">1.0f0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[21]:1 within `g`
define [2 x float] @julia_g_3750([2 x float]* nocapture noundef nonnull readonly align 4 dereferenceable(8) %0, [2 x float]* nocapture noundef nonnull readonly align 4 dereferenceable(8) %1) #0 {
top:
;  @ In[21]:4 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ In[47]:2 within `+`
; ││┌ @ Base.jl:37 within `getproperty`
     %2 = getelementptr inbounds [2 x float], [2 x float]* %0, i64 0, i64 0
; ││└
; ││ @ In[47]:2 within `+` @ promotion.jl:410 @ float.jl:408
    %3 = load float, float* %2, align 4
    %4 = fadd float %3, 4.000000e+00
; ││ @ In[47]:2 within `+`
; ││┌ @ Base.jl:37 within `getproperty`
     %5 = getelementptr inbounds [2 x float], [2 x float]* %0, i64 0, i64 1
; └└└
;  @ In[21]:5 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ In[47]:3 within `+` @ promotion.jl:410 @ float.jl:408
    %6 = fadd float %4, 2.000000e+00
; └└
;  @ In[21]:6 within `g`
; ┌ @ In[18]:1 within `f`
; │┌ @ In[47]:1 within `+`
; ││┌ @ Base.jl:37 within `getproperty`
     %7 = getelementptr inbounds [2 x float], [2 x float]* %1, i64 0, i64 0
; ││└
; ││ @ In[47]:1 within `+` @ float.jl:408
    %8 = load float, float* %7, align 4
    %9 = fadd float %8, %6
; ││ @ In[47]:1 within `+`
; ││┌ @ Base.jl:37 within `getproperty`
     %10 = getelementptr inbounds [2 x float], [2 x float]* %1, i64 0, i64 1
; ││└
; ││ @ In[47]:1 within `+` @ float.jl:408
    %11 = load float, float* %5, align 4
    %12 = load float, float* %10, align 4
    %13 = fadd float %11, %12
; └└
  %.fca.0.insert = insertvalue [2 x float] zeroinitializer, float %9, 0
  %.fca.1.insert = insertvalue [2 x float] %.fca.0.insert, float %13, 1
  ret [2 x float] %.fca.1.insert
}</code></pre>
</div>
</div>
<p>It is important to know that if there is any piece of a type which doesn’t contain type information, then it cannot be isbits because then it would have to be compiled in such a way that the size is not known in advance. For example:</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MySlowComplex</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  real</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  imag</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">isbits</span>(<span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>false</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MySlowComplex</span>, b<span class="op">::</span><span class="dt">MySlowComplex</span>) <span class="op">=</span> <span class="fu">MySlowComplex</span>(a.real <span class="op">+</span> b.real, a.imag <span class="op">+</span> b.imag)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MySlowComplex</span>, b<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="fu">MySlowComplex</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(b<span class="op">::</span><span class="dt">Int</span>, a<span class="op">::</span><span class="dt">MySlowComplex</span>) <span class="op">=</span> <span class="fu">MySlowComplex</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(<span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>), <span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>MySlowComplex(8.0, 2.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">g</span>(<span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>), <span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for g(::MySlowComplex, ::MySlowComplex)
  from g(x, y) @ Main In[21]:1
Arguments
  #self#::Core.Const(g)
  x::MySlowComplex
  y::MySlowComplex
Locals
  d::MySlowComplex
  c::MySlowComplex
  b::Int64
  a::Int64
Body::MySlowComplex
1 ─      (a = 4)
│        (b = 2)
│        (c = Main.f(x, a::Core.Const(4)))
│        (d = Main.f(b::Core.Const(2), c))
│   %5 = Main.f(d, y)::MySlowComplex
└──      return %5
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">g</span>(<span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>), <span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[21]:1 within `g`
define void @julia_g_3819([2 x {}*]* noalias nocapture noundef nonnull sret([2 x {}*]) align 8 dereferenceable(16) %0, [2 x {}*]* nocapture noundef nonnull readonly align 8 dereferenceable(16) %1, [2 x {}*]* nocapture noundef nonnull readonly align 8 dereferenceable(16) %2) #0 {
top:
  %gcframe2 = alloca [8 x {}*], align 16
  %gcframe2.sub = getelementptr inbounds [8 x {}*], [8 x {}*]* %gcframe2, i64 0, i64 0
  %3 = bitcast [8 x {}*]* %gcframe2 to i8*
  call void @llvm.memset.p0i8.i32(i8* noundef nonnull align 16 dereferenceable(64) %3, i8 0, i32 64, i1 false)
  %4 = getelementptr inbounds [8 x {}*], [8 x {}*]* %gcframe2, i64 0, i64 6
  %5 = bitcast {}** %4 to [2 x {}*]*
  %6 = getelementptr inbounds [8 x {}*], [8 x {}*]* %gcframe2, i64 0, i64 4
  %7 = bitcast {}** %6 to [2 x {}*]*
  %8 = getelementptr inbounds [8 x {}*], [8 x {}*]* %gcframe2, i64 0, i64 2
  %9 = bitcast {}** %8 to [2 x {}*]*
  %thread_ptr = call i8* asm "movq %fs:0, $0", "=r"() #6
  %ppgcstack_i8 = getelementptr i8, i8* %thread_ptr, i64 -8
  %ppgcstack = bitcast i8* %ppgcstack_i8 to {}****
  %pgcstack = load {}***, {}**** %ppgcstack, align 8
;  @ In[21]:4 within `g`
; ┌ @ In[18]:1 within `f`
   %10 = bitcast [8 x {}*]* %gcframe2 to i64*
   store i64 24, i64* %10, align 16
   %11 = getelementptr inbounds [8 x {}*], [8 x {}*]* %gcframe2, i64 0, i64 1
   %12 = bitcast {}** %11 to {}***
   %13 = load {}**, {}*** %pgcstack, align 8
   store {}** %13, {}*** %12, align 8
   %14 = bitcast {}*** %pgcstack to {}***
   store {}** %gcframe2.sub, {}*** %14, align 8
   call void @"j_+_3821"([2 x {}*]* noalias nocapture noundef nonnull sret([2 x {}*]) %5, [2 x {}*]* nocapture nonnull readonly %1, i64 signext 4) #0
; └
;  @ In[21]:5 within `g`
; ┌ @ In[18]:1 within `f`
   call void @"j_+_3822"([2 x {}*]* noalias nocapture noundef nonnull sret([2 x {}*]) %7, i64 signext 2, [2 x {}*]* nocapture readonly %5) #0
; └
;  @ In[21]:6 within `g`
; ┌ @ In[18]:1 within `f`
   call void @"j_+_3823"([2 x {}*]* noalias nocapture noundef nonnull sret([2 x {}*]) %9, [2 x {}*]* nocapture readonly %7, [2 x {}*]* nocapture nonnull readonly %2) #0
; └
  %15 = bitcast [2 x {}*]* %0 to i8*
  %16 = bitcast {}** %8 to i8*
  call void @llvm.memcpy.p0i8.p0i8.i64(i8* noundef nonnull align 8 dereferenceable(16) %15, i8* noundef nonnull align 16 dereferenceable(16) %16, i64 16, i1 false)
  %17 = load {}*, {}** %11, align 8
  %18 = bitcast {}*** %pgcstack to {}**
  store {}* %17, {}** %18, align 8
  ret void
}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MySlowComplex2</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  real<span class="op">::</span><span class="dt">AbstractFloat</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  imag<span class="op">::</span><span class="dt">AbstractFloat</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">isbits</span>(<span class="fu">MySlowComplex2</span>(<span class="fl">1.0</span>,  <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>false</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MySlowComplex2</span>, b<span class="op">::</span><span class="dt">MySlowComplex2</span>) <span class="op">=</span> <span class="fu">MySlowComplex2</span>(a.real <span class="op">+</span> b.real, a.imag <span class="op">+</span> b.imag)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(a<span class="op">::</span><span class="dt">MySlowComplex2</span>, b<span class="op">::</span><span class="dt">Int</span>) <span class="op">=</span> <span class="fu">MySlowComplex2</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Base</span>.<span class="op">:</span><span class="fu">+</span>(b<span class="op">::</span><span class="dt">Int</span>, a<span class="op">::</span><span class="dt">MySlowComplex2</span>) <span class="op">=</span> <span class="fu">MySlowComplex2</span>(a.real <span class="op">+</span> b, a.imag)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(<span class="fu">MySlowComplex2</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>), <span class="fu">MySlowComplex2</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>MySlowComplex2(8.0, 2.0)</code></pre>
</div>
</div>
<p>Here’s the timings:</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="fu">MyComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fu">MyComplex</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">g</span>(a, b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  16.782 ns (1 allocation: 32 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>MyComplex(9.0, 2.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="fu">MyParameterizedComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fu">MyParameterizedComplex</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">g</span>(a, b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  16.845 ns (1 allocation: 32 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>MyParameterizedComplex{Float64}(9.0, 2.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="fu">MySlowComplex</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fu">MySlowComplex</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">g</span>(a, b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  85.371 ns (5 allocations: 96 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>MySlowComplex(9.0, 2.0)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="fu">MySlowComplex2</span>(<span class="fl">1.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fu">MySlowComplex2</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">g</span>(a, b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  667.079 ns (14 allocations: 288 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>MySlowComplex2(9.0, 2.0)</code></pre>
</div>
</div>
</section>
<section id="note-on-julia" class="level3" data-number="1.2.10">
<h3 data-number="1.2.10" class="anchored" data-anchor-id="note-on-julia"><span class="header-section-number">1.2.10</span> Note on Julia</h3>
<p>Note that, because of these type specialization, value types, etc. properties, the number types, even ones such as <code>Int</code>, <code>Float64</code>, and <code>Complex</code>, are all themselves implemented in pure Julia! Thus even basic pieces can be implemented in Julia with full performance, given one uses the features correctly.</p>
</section>
<section id="note-on-isbits" class="level3" data-number="1.2.11">
<h3 data-number="1.2.11" class="anchored" data-anchor-id="note-on-isbits"><span class="header-section-number">1.2.11</span> Note on isbits</h3>
<p>Note that a type which is <code>mutable struct</code> will not be isbits. This means that mutable structs will be a pointer to a heap allocated object, unless it’s shortlived and the compiler can erase its construction. Also, note that <code>isbits</code> compiles down to bit operations from pure Julia, which means that these types can directly compile to GPU kernels through CUDAnative without modification.</p>
</section>
<section id="function-barriers" class="level3" data-number="1.2.12">
<h3 data-number="1.2.12" class="anchored" data-anchor-id="function-barriers"><span class="header-section-number">1.2.12</span> Function Barriers</h3>
<p>Since functions automatically specialize on their input types in Julia, we can use this to our advantage in order to make an inner loop fully inferred. For example, take the code from above but with a loop:</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">r</span>(x)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fu">f</span>(x[<span class="fl">1</span>], a)</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="fu">f</span>(b, c)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">f</span>(d, x[<span class="fl">2</span>])</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>  a</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">r</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  4.648 μs (300 allocations: 4.69 KiB)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>604.0</code></pre>
</div>
</div>
<p>In here, the loop variables are not inferred and thus this is really slow. However, we can force a function call in the middle to end up with specialization and in the inner loop be stable:</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">s</span>(x) <span class="op">=</span> <span class="fu">_s</span>(x[<span class="fl">1</span>], x[<span class="fl">2</span>])</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">_s</span>(x1, x2)</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fu">f</span>(x1, a)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="fu">f</span>(b, c)</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">f</span>(d, x2)</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>  a</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">s</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  304.462 ns (1 allocation: 16 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>604.0</code></pre>
</div>
</div>
<p>Notice that this algorithm still doesn’t infer:</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_warntype</span> <span class="fu">s</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for s(::Vector{Number})
  from s(x) @ Main In[62]:1
Arguments
  #self#::Core.Const(s)
  x::Vector{Number}
Body::Any
1 ─ %1 = Base.getindex(x, 1)::Number
│   %2 = Base.getindex(x, 2)::Number
│   %3 = Main._s(%1, %2)::Any
└──      return %3
</code></pre>
</div>
</div>
<p>since the output of <code>_s</code> isn’t inferred, but while it’s in <code>_s</code> it will have specialized on the fact that <code>x[1]</code> is a <code>Float64</code> while <code>x[2]</code> is a <code>Int</code>, making that inner loop fast. In fact, it will only need to pay one <em>dynamic dispatch</em>, i.e.&nbsp;a multiple dispatch determination that happens at runtime. Notice that whenever functions are inferred, the dispatching is static since the choice of the dispatch is already made and compiled into the LLVM IR.</p>
</section>
<section id="specialization-at-compile-time" class="level3" data-number="1.2.13">
<h3 data-number="1.2.13" class="anchored" data-anchor-id="specialization-at-compile-time"><span class="header-section-number">1.2.13</span> Specialization at Compile Time</h3>
<p>Julia code will specialize at compile time if it can prove something about the result. For example:</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fff</span>(x)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> x isa <span class="dt">Int</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  x <span class="op">+</span> y</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>fff (generic function with 1 method)</code></pre>
</div>
</div>
<p>You might think this function has a branch, but in reality Julia can determine whether <code>x</code> is an <code>Int</code> or not at compile time, so it will actually compile it away and just turn it into the function <code>x + 2</code> or <code>x + 4.0</code>:</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">fff</span>(<span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[64]:1 within `fff`
define i64 @julia_fff_4048(i64 signext %0) #0 {
top:
;  @ In[64]:7 within `fff`
; ┌ @ int.jl:87 within `+`
   %1 = add i64 %0, 2
; └
  ret i64 %1
}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">fff</span>(<span class="fl">2.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[64]:1 within `fff`
define double @julia_fff_4050(double %0) #0 {
top:
;  @ In[64]:7 within `fff`
; ┌ @ float.jl:408 within `+`
   %1 = fadd double %0, 4.000000e+00
; └
  ret double %1
}</code></pre>
</div>
</div>
<p>Thus one does not need to worry about over-optimizing since in the obvious cases the compiler will actually remove all of the extra pieces when it can!</p>
</section>
<section id="global-scope-and-optimizations" class="level3" data-number="1.2.14">
<h3 data-number="1.2.14" class="anchored" data-anchor-id="global-scope-and-optimizations"><span class="header-section-number">1.2.14</span> Global Scope and Optimizations</h3>
<p>This discussion shows how Julia’s optimizations all apply during function specialization times. Thus calling Julia functions is fast. But what about when doing something outside of the function, like directly in a module or in the REPL?</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">global</span> A, B, C</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  C[i, j] <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  641.637 μs (30000 allocations: 468.75 KiB)</code></pre>
</div>
</div>
<p>This is very slow because the types of <code>A</code>, <code>B</code>, and <code>C</code> cannot be inferred. Why can’t they be inferred? Well, at any time in the dynamic REPL scope I can do something like <code>C = "haha now a string!"</code>, and thus it cannot specialize on the types currently existing in the REPL (since asynchronous changes could also occur), and therefore it defaults back to doing a type check at every single function which slows it down. Moral of the story, Julia functions are fast but its global scope is too dynamic to be optimized.</p>
</section>
<section id="summary" class="level3" data-number="1.2.15">
<h3 data-number="1.2.15" class="anchored" data-anchor-id="summary"><span class="header-section-number">1.2.15</span> Summary</h3>
<ul>
<li>Julia is not fast because of its JIT, it’s fast because of function specialization and type inference</li>
<li>Type stable functions allow inference to fully occur</li>
<li>Multiple dispatch works within the function specialization mechanism to create overhead-free compile time controls</li>
<li>Julia will specialize the generic functions</li>
<li>Making sure values are concretely typed in inner loops is essential for performance</li>
</ul>
</section>
</section>
<section id="overheads-of-individual-operations" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="overheads-of-individual-operations"><span class="header-section-number">1.3</span> Overheads of Individual Operations</h2>
<p>Now let’s dig even a little deeper. Everything the processor does has a cost. A great chart to keep in mind is <a href="http://ithare.com/infographics-operation-costs-in-cpu-clock-cycles/">this classic one</a>. A few things should immediately jump out to you:</p>
<ul>
<li>Simple arithmetic, like floating point additions, are super cheap. ~1 clock cycle, or a few nanoseconds.</li>
<li>Processors do <em>branch prediction</em> on <code>if</code> statements. If the code goes down the predicted route, the <code>if</code> statement costs ~1-2 clock cycles. If it goes down the wrong route, then it will take ~10-20 clock cycles. This means that predictable branches, like ones with clear patterns or usually the same output, are much cheaper (almost free) than unpredictable branches.</li>
<li>Function calls are expensive: 15-60 clock cycles!</li>
<li>RAM reads are very expensive, with lower caches less expensive.</li>
</ul>
<section id="bounds-checking" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="bounds-checking"><span class="header-section-number">1.3.1</span> Bounds Checking</h3>
<p>Let’s check the LLVM IR on one of our earlier loops:</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_noalloc!</span>(C, A, B)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> val[<span class="fl">1</span>]</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">inner_noalloc!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[68]:1 within `inner_noalloc!`
define nonnull {}* @"japi1_inner_noalloc!_4059"({}* %0, {}** noalias nocapture noundef readonly %1, i32 %2) #0 {
top:
  %3 = alloca {}**, align 8
  store volatile {}** %1, {}*** %3, align 8
  %4 = load {}*, {}** %1, align 8
  %5 = getelementptr inbounds {}*, {}** %1, i64 1
  %6 = load {}*, {}** %5, align 8
  %7 = getelementptr inbounds {}*, {}** %1, i64 2
  %8 = load {}*, {}** %7, align 8
  %9 = bitcast {}* %6 to {}**
  %10 = getelementptr inbounds {}*, {}** %9, i64 3
  %11 = bitcast {}** %10 to i64*
  %12 = load i64, i64* %11, align 8
  %13 = getelementptr inbounds {}*, {}** %9, i64 4
  %14 = bitcast {}** %13 to i64*
  %15 = bitcast {}* %6 to double**
  %16 = bitcast {}* %8 to {}**
  %17 = getelementptr inbounds {}*, {}** %16, i64 3
  %18 = bitcast {}** %17 to i64*
  %19 = getelementptr inbounds {}*, {}** %16, i64 4
  %20 = bitcast {}** %19 to i64*
  %21 = bitcast {}* %8 to double**
  %22 = bitcast {}* %4 to {}**
  %23 = getelementptr inbounds {}*, {}** %22, i64 3
  %24 = bitcast {}** %23 to i64*
  %25 = getelementptr inbounds {}*, {}** %22, i64 4
  %26 = bitcast {}** %25 to i64*
  %27 = bitcast {}* %4 to double**
;  @ In[68]:2 within `inner_noalloc!`
  br label %L2

L2:                                               ; preds = %L25, %top
  %value_phi = phi i64 [ 1, %top ], [ %61, %L25 ]
  %28 = add nsw i64 %value_phi, -1
  %29 = load i64, i64* %14, align 8
  %30 = icmp ult i64 %28, %29
  %31 = mul i64 %12, %28
  %32 = load double*, double** %15, align 8
  %33 = load i64, i64* %18, align 8
  %34 = mul i64 %33, %28
  %35 = load double*, double** %21, align 8
  %36 = load i64, i64* %24, align 8
  %37 = load i64, i64* %26, align 8
  %38 = icmp ult i64 %28, %37
  %39 = mul i64 %36, %28
  %40 = load double*, double** %27, align 8
  br i1 %30, label %L2.split.us, label %oob

L2.split.us:                                      ; preds = %L2
  %41 = load i64, i64* %20, align 8
  %42 = icmp ult i64 %28, %41
  %smin61 = call i64 @llvm.smin.i64(i64 %33, i64 0)
  %43 = sub i64 %33, %smin61
  %smax62 = call i64 @llvm.smax.i64(i64 %smin61, i64 -1)
  %44 = add nsw i64 %smax62, 1
  %45 = mul nuw nsw i64 %43, %44
  %umin63 = call i64 @llvm.umin.i64(i64 %12, i64 %45)
  %smin64 = call i64 @llvm.smin.i64(i64 %36, i64 0)
  %46 = sub i64 %36, %smin64
  %smax65 = call i64 @llvm.smax.i64(i64 %smin64, i64 -1)
  %47 = add nsw i64 %smax65, 1
  %48 = mul nuw nsw i64 %46, %47
  %umin66 = call i64 @llvm.umin.i64(i64 %umin63, i64 %48)
  %exit.mainloop.at68 = call i64 @llvm.umin.i64(i64 %umin66, i64 100)
  %.not205 = icmp eq i64 %exit.mainloop.at68, 0
  br i1 %42, label %L2.split.us.split.us, label %L2.split.us.L2.split.us.split_crit_edge

L2.split.us.L2.split.us.split_crit_edge:          ; preds = %L2.split.us
  %.not203 = icmp eq i64 %12, 0
  %or.cond = select i1 %.not205, i1 %.not203, i1 false
  br i1 %or.cond, label %oob, label %oob5

L2.split.us.split.us:                             ; preds = %L2.split.us
  br i1 %.not205, label %main.pseudo.exit71, label %ib7.us.us

ib7.us.us:                                        ; preds = %idxend9.us.us, %L2.split.us.split.us
  %value_phi2.us.us = phi i64 [ %59, %idxend9.us.us ], [ 1, %L2.split.us.split.us ]
;  @ In[68]:3 within `inner_noalloc!`
; ┌ @ essentials.jl:14 within `getindex`
   %49 = add i64 %value_phi2.us.us, -1
; └
;  @ In[68]:4 within `inner_noalloc!`
; ┌ @ array.jl:971 within `setindex!`
   br i1 %38, label %idxend9.us.us, label %oob8

idxend9.us.us:                                    ; preds = %ib7.us.us
; └
;  @ In[68]:3 within `inner_noalloc!`
; ┌ @ essentials.jl:14 within `getindex`
   %50 = add i64 %31, %49
   %51 = getelementptr inbounds double, double* %32, i64 %50
   %52 = load double, double* %51, align 8
   %53 = add i64 %34, %49
   %54 = getelementptr inbounds double, double</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>* %35, i64 %53
   %55 = load double, double* %54, align 8
; └
; ┌ @ float.jl:408 within `+`
   %56 = fadd double %52, %55
; └
;  @ In[68]:4 within `inner_noalloc!`
; ┌ @ array.jl:971 within `setindex!`
   %57 = add i64 %39, %49
   %58 = getelementptr inbounds double, double* %40, i64 %57
   store double %56, double* %58, align 8
; └
;  @ In[68]:5 within `inner_noalloc!`
; ┌ @ range.jl:891 within `iterate`
   %59 = add i64 %value_phi2.us.us, 1
; └
  %.not206 = icmp ult i64 %value_phi2.us.us, %exit.mainloop.at68
  br i1 %.not206, label %ib7.us.us, label %main.exit.selector70

main.exit.selector70:                             ; preds = %idxend9.us.us
  %60 = icmp ult i64 %value_phi2.us.us, 100
  br i1 %60, label %main.pseudo.exit71, label %L25

main.pseudo.exit71:                               ; preds = %main.exit.selector70, %L2.split.us.split.us
  %value_phi2.us.us.copy = phi i64 [ 1, %L2.split.us.split.us ], [ %59, %main.exit.selector70 ]
  br label %L5.us.us.postloop

L25:                                              ; preds = %idxend9.us.us.postloop, %main.exit.selector70
; ┌ @ range.jl:891 within `iterate`
; │┌ @ promotion.jl:499 within `==`
    %.not18 = icmp eq i64 %value_phi, 100
; │└
   %61 = add nuw nsw i64 %value_phi, 1
; └
  br i1 %.not18, label %L36, label %L2

L36:                                              ; preds = %L25
  ret {}* inttoptr (i64 140594586316808 to {}*)

oob:                                              ; preds = %L5.us.us.postloop, %L2.split.us.L2.split.us.split_crit_edge, %L2
  %value_phi2.lcssa = phi i64 [ 1, %L2.split.us.L2.split.us.split_crit_edge ], [ %value_phi2.us.us.postloop, %L5.us.us.postloop ], [ 1, %L2 ]
;  @ In[68]:3 within `inner_noalloc!`
; ┌ @ essentials.jl:14 within `getindex`
   %62 = alloca [2 x i64], align 8
   %.sub = getelementptr inbounds [2 x i64], [2 x i64]* %62, i64 0, i64 0
   store i64 %value_phi2.lcssa, i64* %.sub, align 8
   %63 = getelementptr inbounds [2 x i64], [2 x i64]* %62, i64 0, i64 1
   store i64 %value_phi, i64* %63, align 8
   call void @ijl_bounds_error_ints({}* %6, i64* nonnull %.sub, i64 2)
   unreachable

oob5:                                             ; preds = %idxend.us.us.postloop, %L2.split.us.L2.split.us.split_crit_edge
   %value_phi2.lcssa19 = phi i64 [ 1, %L2.split.us.L2.split.us.split_crit_edge ], [ %value_phi2.us.us.postloop, %idxend.us.us.postloop ]
   %64 = alloca [2 x i64], align 8
   %.sub16 = getelementptr inbounds [2 x i64], [2 x i64]* %64, i64 0, i64 0
   store i64 %value_phi2.lcssa19, i64* %.sub16, align 8
   %65 = getelementptr inbounds [2 x i64], [2 x i64]* %64, i64 0, i64 1
   store i64 %value_phi, i64* %65, align 8
   call void @ijl_bounds_error_ints({}* %8, i64* nonnull %.sub16, i64 2)
   unreachable

oob8.loopexit:                                    ; preds = %idxend6.us.us.postloop
; └
;  @ In[68]:4 within `inner_noalloc!`
; ┌ @ array.jl:971 within `setindex!`
   %value_phi2.us.us.postloop.mux = select i1 %71, i64 %value_phi2.us.us.postloop, i64 %value_phi2.us.us.copy
   br label %oob8

oob8:                                             ; preds = %oob8.loopexit, %ib7.us.us
   %value_phi2.lcssa20 = phi i64 [ %value_phi2.us.us.postloop.mux, %oob8.loopexit ], [ 1, %ib7.us.us ]
   %66 = alloca [2 x i64], align 8
   %.sub17 = getelementptr inbounds [2 x i64], [2 x i64]* %66, i64 0, i64 0
   store i64 %value_phi2.lcssa20, i64* %.sub17, align 8
   %67 = getelementptr inbounds [2 x i64], [2 x i64]* %66, i64 0, i64 1
   store i64 %value_phi, i64* %67, align 8
   call void @ijl_bounds_error_ints({}* %4, i64* nonnull %.sub17, i64 2)
   unreachable

L5.us.us.postloop:                                ; preds = %idxend9.us.us.postloop, %main.pseudo.exit71
   %value_phi2.us.us.postloop = phi i64 [ %value_phi2.us.us.copy, %main.pseudo.exit71 ], [ %81, %idxend9.us.us.postloop ]
; └
;  @ In[68]:3 within `inner_noalloc!`
; ┌ @ essentials.jl:14 within `getindex`
   %68 = add i64 %value_phi2.us.us.postloop, -1
   %69 = icmp ult i64 %68, %12
   br i1 %69, label %idxend.us.us.postloop, label %oob

idxend.us.us.postloop:                            ; preds = %L5.us.us.postloop
   %70 = icmp ult i64 %68, %33
   br i1 %70, label %idxend6.us.us.postloop, label %oob5

idxend6.us.us.postloop:                           ; preds = %idxend.us.us.postloop
; └
;  @ In[68]:4 within `inner_noalloc!`
; ┌ @ array.jl:971 within `setindex!`
   %71 = icmp uge i64 %68, %36
   %.not208 = xor i1 %38, true
   %brmerge = select i1 %71, i1 true, i1 %.not208
   br i1 %brmerge, label %oob8.loopexit, label %idxend9.us.us.postloop

idxend9.us.us.postloop:                           ; preds = %idxend6.us.us.postloop
; └
;  @ In[68]:3 within `inner_noalloc!`
; ┌ @ essentials.jl:14 within `getindex`
   %72 = add i64 %31</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>, %68
   %73 = getelementptr inbounds double, double* %32, i64 %72
   %74 = load double, double* %73, align 8
   %75 = add i64 %34, %68
   %76 = getelementptr inbounds double, double* %35, i64 %75
   %77 = load double, double* %76, align 8
; └
; ┌ @ float.jl:408 within `+`
   %78 = fadd double %74, %77
; └
;  @ In[68]:4 within `inner_noalloc!`
; ┌ @ array.jl:971 within `setindex!`
   %79 = add i64 %39, %68
   %80 = getelementptr inbounds double, double* %40, i64 %79
   store double %78, double* %80, align 8
; └
;  @ In[68]:5 within `inner_noalloc!`
; ┌ @ range.jl:891 within `iterate`
; │┌ @ promotion.jl:499 within `==`
    %.not.us.us.postloop = icmp eq i64 %value_phi2.us.us.postloop, 100
; │└
   %81 = add nuw nsw i64 %value_phi2.us.us.postloop, 1
; └
  br i1 %.not.us.us.postloop, label %L25, label %L5.us.us.postloop
}</code></pre>
</div>
</div>
<p>Notice that this <code>getelementptr inbounds</code> stuff is bounds checking. Julia, like all other high level languages, enables bounds checking by default in order to not allow the user to index outside of an array. Indexing outside of an array is dangerous: it can quite easily segfault your system if you change some memory that is unknown beyond your actual array. Thus Julia throws an error:</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>A[<span class="fl">101</span>, <span class="fl">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>LoadError: BoundsError: attempt to access 100×100 Matrix{Float64} at index [101, 1]</code></pre>
</div>
</div>
<p>In tight inner loops, we can remove this bounds checking process using the <code>@inbounds</code> macro:</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">inner_noalloc_ib!</span>(C, A, B)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="pp">@inbounds</span> <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> A[i, j] <span class="op">+</span> B[i, j]</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>    C[i, j] <span class="op">=</span> val[<span class="fl">1</span>]</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_noalloc!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  7.716 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">inner_noalloc_ib!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  2.026 μs (0 allocations: 0 bytes)</code></pre>
</div>
</div>
</section>
<section id="simd" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="simd"><span class="header-section-number">1.3.2</span> SIMD</h3>
<p>Now let’s inspect the LLVM IR again:</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">inner_noalloc_ib!</span>(C, A, B)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[70]:1 within `inner_noalloc_ib!`
define nonnull {}* @"japi1_inner_noalloc_ib!_4098"({}* %0, {}** noalias nocapture noundef readonly %1, i32 %2) #0 {
top:
  %3 = alloca {}**, align 8
  store volatile {}** %1, {}*** %3, align 8
  %4 = load {}*, {}** %1, align 8
  %5 = getelementptr inbounds {}*, {}** %1, i64 1
  %6 = load {}*, {}** %5, align 8
  %7 = getelementptr inbounds {}*, {}** %1, i64 2
  %8 = load {}*, {}** %7, align 8
  %9 = bitcast {}* %6 to {}**
  %10 = getelementptr inbounds {}*, {}** %9, i64 3
  %11 = bitcast {}** %10 to i64*
  %12 = load i64, i64* %11, align 8
  %13 = bitcast {}* %6 to double**
  %14 = load double*, double** %13, align 8
  %15 = bitcast {}* %8 to {}**
  %16 = getelementptr inbounds {}*, {}** %15, i64 3
  %17 = bitcast {}** %16 to i64*
  %18 = load i64, i64* %17, align 8
  %19 = bitcast {}* %8 to double**
  %20 = load double*, double** %19, align 8
  %21 = bitcast {}* %4 to {}**
  %22 = getelementptr inbounds {}*, {}** %21, i64 3
  %23 = bitcast {}** %22 to i64*
  %24 = load i64, i64* %23, align 8
  %25 = bitcast {}* %4 to double**
  %26 = load double*, double** %25, align 8
;  @ In[70]:2 within `inner_noalloc_ib!`
  br label %L2

L2:                                               ; preds = %L25, %top
  %indvar = phi i64 [ %indvar.next, %L25 ], [ 0, %top ]
  %value_phi = phi i64 [ %59, %L25 ], [ 1, %top ]
  %27 = mul i64 %24, %indvar
  %scevgep = getelementptr double, double* %26, i64 %27
  %28 = add i64 %27, 100
  %scevgep12 = getelementptr double, double* %26, i64 %28
  %29 = mul i64 %12, %indvar
  %30 = mul i64 %18, %indvar
  %31 = add nsw i64 %value_phi, -1
  %32 = mul i64 %12, %31
  %33 = mul i64 %18, %31
  %34 = mul i64 %24, %31
  %35 = add i64 %30, 100
  %scevgep20 = getelementptr double, double* %20, i64 %35
  %scevgep18 = getelementptr double, double* %20, i64 %30
  %36 = add i64 %29, 100
  %scevgep16 = getelementptr double, double* %14, i64 %36
  %scevgep14 = getelementptr double, double* %14, i64 %29
  %bound0 = icmp ult double* %scevgep, %scevgep16
  %bound1 = icmp ult double* %scevgep14, %scevgep12
  %found.conflict = and i1 %bound0, %bound1
  %bound022 = icmp ult double* %scevgep, %scevgep20
  %bound123 = icmp ult double* %scevgep18, %scevgep12
  %found.conflict24 = and i1 %bound022, %bound123
  %conflict.rdx = or i1 %found.conflict, %found.conflict24
  br i1 %conflict.rdx, label %L5, label %vector.body

vector.body:                                      ; preds = %vector.body, %L2
  %index = phi i64 [ %index.next, %vector.body ], [ 0, %L2 ]
;  @ In[70]:3 within `inner_noalloc_ib!`
; ┌ @ essentials.jl:14 within `getindex`
   %37 = add i64 %index, %32
   %38 = getelementptr inbounds double, double* %14, i64 %37
   %39 = bitcast double* %38 to &lt;4 x double&gt;*
   %wide.load = load &lt;4 x double&gt;, &lt;4 x double&gt;* %39, align 8
   %40 = add i64 %index, %33
   %41 = getelementptr inbounds double, double* %20, i64 %40
   %42 = bitcast double* %41 to &lt;4 x double&gt;*
   %wide.load25 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %42, align 8
; └
; ┌ @ float.jl:408 within `+`
   %43 = fadd &lt;4 x double&gt; %wide.load, %wide.load25
; └
;  @ In[70]:4 within `inner_noalloc_ib!`
; ┌ @ array.jl:971 within `setindex!`
   %44 = add i64 %index, %34
   %45 = getelementptr inbounds double, double* %26, i64 %44
   %46 = bitcast double* %45 to &lt;4 x double&gt;*
   store &lt;4 x double&gt; %43, &lt;4 x double&gt;* %46, align 8
   %index.next = add nuw i64 %index, 4
   %47 = icmp eq i64 %index.next, 100
   br i1 %47, label %L25, label %vector.body

L5:                                               ; preds = %L5, %L2
   %value_phi2 = phi i64 [ %58, %L5 ], [ 1, %L2 ]
; └
;  @ In[70]:3 within `inner_noalloc_ib!`
; ┌ @ essentials.jl:14 within `getindex`
   %48 = add nsw i64 %value_phi2, -1
   %49 = add i64 %48, %32
   %50 = getelementptr inbounds double, double</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>* %14, i64 %49
   %51 = load double, double* %50, align 8
   %52 = add i64 %48, %33
   %53 = getelementptr inbounds double, double* %20, i64 %52
   %54 = load double, double* %53, align 8
; └
; ┌ @ float.jl:408 within `+`
   %55 = fadd double %51, %54
; └
;  @ In[70]:4 within `inner_noalloc_ib!`
; ┌ @ array.jl:971 within `setindex!`
   %56 = add i64 %48, %34
   %57 = getelementptr inbounds double, double* %26, i64 %56
   store double %55, double* %57, align 8
; └
;  @ In[70]:5 within `inner_noalloc_ib!`
; ┌ @ range.jl:891 within `iterate`
; │┌ @ promotion.jl:499 within `==`
    %.not.not = icmp eq i64 %value_phi2, 100
; │└
   %58 = add nuw nsw i64 %value_phi2, 1
; └
  br i1 %.not.not, label %L25, label %L5

L25:                                              ; preds = %L5, %vector.body
; ┌ @ range.jl:891 within `iterate`
; │┌ @ promotion.jl:499 within `==`
    %.not.not10 = icmp eq i64 %value_phi, 100
; │└
   %59 = add nuw nsw i64 %value_phi, 1
; └
  %indvar.next = add i64 %indvar, 1
  br i1 %.not.not10, label %L36, label %L2

L36:                                              ; preds = %L25
  ret {}* inttoptr (i64 140594586316808 to {}*)
}</code></pre>
</div>
</div>
<p>If you look closely, you will see things like:</p>
<pre><code>%wide.load24 = load &lt;4 x double&gt;, &lt;4 x double&gt; addrspac(13)* %46, align 8
; └
; ┌ @ float.jl:395 within `+'
%47 = fadd &lt;4 x double&gt; %wide.load, %wide.load24</code></pre>
<p>What this is saying is that it’s loading and adding 4 <code>Float64</code>s at a time! This feature of the processor is known as SIMD: single input multiple data. If certain primitive floating point operations, like <code>+</code> and <code>*</code>, are done in succession (i.e.&nbsp;no inbounds checks between them!), then the processor can lump them together and do multiples at once. Since clock cycles have stopped improving while transistors have gotten smaller, this “lumping” has been a big source of speedups in computational mathematics even though the actual <code>+</code> and <code>*</code> hasn’t gotten faster. Thus to get full speed we want to make sure this is utilized whenever possible, which essentially just amounts to doing type inferred loops with no branches or bounds checks in the way.</p>
</section>
<section id="fma" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="fma"><span class="header-section-number">1.3.3</span> FMA</h3>
<p>Modern processors have a single operation that fuses the multiplication and the addition in the operation <code>x*y+z</code>, known as a <em>fused multiply-add</em> or FMA. Note that FMA has less floating point roundoff error than the two operation form. We can see this intrinsic in the resulting LLVM IR:</p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">fma</span>(<span class="fl">2.0</span>, <span class="fl">5.0</span>, <span class="fl">3.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ floatfuncs.jl:439 within `fma`
define double @julia_fma_4099(double %0, double %1, double %2) #0 {
common.ret:
; ┌ @ floatfuncs.jl:434 within `fma_llvm`
   %3 = call double @llvm.fma.f64(double %0, double %1, double %2)
; └
  ret double %3
}</code></pre>
</div>
</div>
<p>The Julia function <code>muladd</code> will automatically choose between FMA and the original form depending on the availability of the routine in the processor. The MuladdMacro.jl package has a macro <code>@muladd</code> which pulls apart statements to add <code>muladd</code> expressions. For example, <code>x1 * y1 + x2 * y2 + x3 * y3</code> can be rewritten as:</p>
<pre><code>muladd(x1, y1, muladd(x2, y2, x3 * y3))</code></pre>
<p>Which reduces the linear combination to just 3 arithmetic operations. FMA operations can be SIMD’d.</p>
</section>
<section id="inlining" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="inlining"><span class="header-section-number">1.3.4</span> Inlining</h3>
<p>All of this would go to waste if function call costs of 50 clock cycles were interrupting every single <code>+</code>. Fortunately these function calls disappear during the compilation process due to what’s known as inlining. Essentially, if the function call is determined to be “cheap enough”, the actual function call is removed and the code is basically pasted into the function caller. We can force a function call to occur by teling it to not inline:</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@noinline</span> <span class="fu">fnoinline</span>(x, y) <span class="op">=</span> x <span class="op">+</span> y</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">finline</span>(x, y) <span class="op">=</span> x <span class="op">+</span> y <span class="co"># Can add @inline, but this is automatic here</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">qinline</span>(x, y)</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>  c <span class="op">=</span> <span class="fu">finline</span>(x, a)</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>  d <span class="op">=</span> <span class="fu">finline</span>(b, c)</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finline</span>(d, y)</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">qnoinline</span>(x, y)</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>  a <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>  b <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>  c <span class="op">=</span> <span class="fu">fnoinline</span>(x, a)</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>  d <span class="op">=</span> <span class="fu">fnoinline</span>(b, c)</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fnoinline</span>(d, y)</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>qnoinline (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">qinline</span>(<span class="fl">1.0</span>, <span class="fl">2.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[74]:3 within `qinline`
define double @julia_qinline_4125(double %0, double %1) #0 {
top:
;  @ In[74]:6 within `qinline`
; ┌ @ In[74]:2 within `finline`
; │┌ @ promotion.jl:410 within `+` @ float.jl:408
    %2 = fadd double %0, 4.000000e+00
; └└
;  @ In[74]:7 within `qinline`
; ┌ @ In[74]:2 within `finline`
; │┌ @ promotion.jl:410 within `+` @ float.jl:408
    %3 = fadd double %2, 2.000000e+00
; └└
;  @ In[74]:8 within `qinline`
; ┌ @ In[74]:2 within `finline`
; │┌ @ float.jl:408 within `+`
    %4 = fadd double %3, %1
; └└
  ret double %4
}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">qnoinline</span>(<span class="fl">1.0</span>, <span class="fl">2.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[74]:10 within `qnoinline`
define double @julia_qnoinline_4127(double %0, double %1) #0 {
top:
;  @ In[74]:13 within `qnoinline`
  %2 = call double @j_fnoinline_4129(double %0, i64 signext 4) #0
;  @ In[74]:14 within `qnoinline`
  %3 = call double @j_fnoinline_4130(i64 signext 2, double %2) #0
;  @ In[74]:15 within `qnoinline`
  %4 = call double @j_fnoinline_4131(double %3, double %1) #0
  ret double %4
}</code></pre>
</div>
</div>
<p>We can see now that it keeps the function calls:</p>
<pre><code>%4 = call double @julia_fnoinline_21538(double %3, double %1)</code></pre>
<p>and this is slower in comparison to what we had before (but it still infers).</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">qinline</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  16.967 ns (1 allocation: 16 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>9.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">qnoinline</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  20.638 ns (1 allocation: 16 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>9.0</code></pre>
</div>
</div>
<p>Note that if we ever want to go the other direction and tell Julia to inline as much as possible, one can use the macro <code>@inline</code>.</p>
</section>
<section id="summary-1" class="level3" data-number="1.3.5">
<h3 data-number="1.3.5" class="anchored" data-anchor-id="summary-1"><span class="header-section-number">1.3.5</span> Summary</h3>
<ul>
<li>Scalar operations are super cheap, and if they are cache-aligned then more than one will occur in a clock cycle.</li>
<li>Inlining a function will remove the high function call overhead.</li>
<li>Branch prediction is pretty good these days, so keep them out of super tight inner loops but don’t worry all too much about them.</li>
<li>Cache misses are quite expensive the further out it goes.</li>
</ul>
</section>
</section>
<section id="note-on-benchmarking" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="note-on-benchmarking"><span class="header-section-number">1.4</span> Note on Benchmarking</h2>
<p>Julia’s compiler is smart. This means that if you don’t try hard enough, Julia’s compiler might get rid of your issues. For example, it can delete branches and directly compute the result if all of the values are known at compile time. So be very careful when benchmarking: your tests may have just compiled away!</p>
<p>Notice the following:</p>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">qinline</span>(<span class="fl">1.0</span>, <span class="fl">2.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  1.153 ns (0 allocations: 0 bytes)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>9.0</code></pre>
</div>
</div>
<p>Dang, that’s much faster! But if you look into it, Julia’s compiler is actually “cheating” on this benchmark:</p>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cheat</span>() <span class="op">=</span> <span class="fu">qinline</span>(<span class="fl">1.0</span>, <span class="fl">2.0</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@code_llvm</span> <span class="fu">cheat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[80]:1 within `cheat`
define double @julia_cheat_4159() #0 {
top:
  ret double 9.000000e+00
}</code></pre>
</div>
</div>
<p>It realized that <code>1.0</code> and <code>2.0</code> are constants, so it did what’s known as <em>constant propagation</em>, and then used those constants inside of the function. It realized that the solution is always <code>9</code>, so it compiled the function that… spits out <code>9</code>! So it’s fast because it’s not computing anything. So be very careful about propagation of constants and literals. In general this is a very helpful feature, but when benchmarking this can cause some weird behavior. If a micro benchmark is taking less than a nanosecond, check and see if the compiler “fixed” your code!</p>
</section>
<section id="conclusion" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">1.5</span> Conclusion</h2>
<p>Optimize your serial code before you parallelize. There’s a lot to think about.</p>
</section>
<section id="discussion-questions" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Discussion Questions</h1>
<p>Here’s a few discussion questions to think about performance engineering in scientific tasks:</p>
<ol type="1">
<li>What are the advantages of a <code>Vector{Array}</code> vs a <code>Matrix</code>? What are the disadvantage? (What’s different?)</li>
<li>What is a good way to implement a data frame?</li>
<li>What are some good things that come out of generic functions for free? What are some things you should watch out for with generic functions?</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction to Parallel Computing</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./sciml.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to Scientific Machine Learning through Physics-Informed Neural Networks</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>